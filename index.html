<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Garmin 年度报告 2025</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/echarts-gl@2/dist/echarts-gl.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/obelisk.js@1.2.1/build/obelisk.min.js"></script>
  <style>
    :root {
      --bg-main: #05070f;
      --bg-soft: #10162b;
      --card-bg: #101a33;
      --card-border: rgba(90, 150, 255, 0.2);
      --text-main: #f4f8ff;
      --text-muted: #94a6cc;
      --accent: #4ca7ff;
      --accent-2: #3bf6d0;
      --accent-danger: #ff7a9e;
    }
    body {
      margin: 0;
      color: var(--text-main);
      background:
        radial-gradient(circle at 20% -10%, rgba(56, 137, 255, 0.24), transparent 40%),
        radial-gradient(circle at 90% 5%, rgba(60, 245, 208, 0.15), transparent 35%),
        linear-gradient(180deg, #04060d 0%, #090f1f 50%, #070b16 100%);
      font-family: "Avenir Next", "DIN Alternate", "Segoe UI", "PingFang SC", "Microsoft YaHei", sans-serif;
      min-height: 100vh;
      padding: clamp(10px, 2.2vw, 24px);
    }
    .report-shell {
      width: min(100%, 1400px);
      max-width: 1400px;
      margin: 0 auto;
      background: rgba(10, 16, 34, 0.7);
      border: 1px solid rgba(120, 172, 255, 0.2);
      border-radius: 22px;
      box-shadow: 0 30px 70px rgba(0, 0, 0, 0.45);
      backdrop-filter: blur(12px);
      overflow: hidden;
    }
    .hero {
      padding: 28px 28px 18px 28px;
      border-bottom: 1px solid rgba(120, 172, 255, 0.2);
      background:
        linear-gradient(125deg, rgba(31, 79, 175, 0.36), rgba(12, 22, 46, 0.7)),
        linear-gradient(50deg, rgba(27, 218, 180, 0.12), transparent 60%);
    }
    .hero-title {
      margin: 0;
      font-size: 34px;
      font-weight: 700;
      letter-spacing: 0.8px;
    }
    .hero-top {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 14px;
      flex-wrap: wrap;
    }
    .share-btn {
      border: 1px solid rgba(111, 179, 255, 0.42);
      background: linear-gradient(90deg, rgba(56, 132, 255, 0.95), rgba(62, 224, 194, 0.95));
      color: #031022;
      font-size: 13px;
      font-weight: 700;
      padding: 9px 14px;
      border-radius: 999px;
      cursor: pointer;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
      box-shadow: 0 8px 20px rgba(59, 173, 255, 0.24);
    }
    .share-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 10px 22px rgba(59, 173, 255, 0.32);
    }
    .share-btn:disabled {
      cursor: not-allowed;
      opacity: 0.72;
      transform: none;
      box-shadow: none;
    }
    .hero-subtitle {
      margin: 8px 0 0 0;
      color: var(--text-muted);
      font-size: 14px;
    }
    .hero-strips {
      margin-top: 18px;
      display: grid;
      grid-template-columns: repeat(3, minmax(160px, 1fr));
      gap: 14px;
    }
    .hero-chip {
      background: linear-gradient(150deg, rgba(24, 37, 70, 0.95), rgba(15, 24, 49, 0.95));
      border: 1px solid var(--card-border);
      border-radius: 14px;
      padding: 12px 14px;
    }
    .hero-chip .label {
      color: var(--text-muted);
      font-size: 12px;
      margin-bottom: 6px;
    }
    .hero-chip .value {
      font-size: 19px;
      font-weight: 600;
    }
    .tab-header {
      display: flex;
      gap: 10px;
      padding: 14px 20px;
      border-bottom: 1px solid rgba(120, 172, 255, 0.16);
      overflow-x: auto;
      background: rgba(8, 15, 33, 0.8);
    }
    .tab-button {
      border: 1px solid rgba(99, 149, 255, 0.25);
      color: #bfd2ff;
      background: rgba(19, 32, 66, 0.72);
      border-radius: 999px;
      font-size: 14px;
      font-weight: 600;
      padding: 8px 16px;
      cursor: pointer;
      white-space: nowrap;
      transition: all 0.2s ease;
    }
    .tab-button.active {
      color: #091126;
      background: linear-gradient(90deg, #6ac1ff, #56f2cf);
      border-color: transparent;
      box-shadow: 0 8px 18px rgba(73, 199, 255, 0.25);
    }
    .content {
      padding: 22px;
    }
    .section-grid {
      display: grid;
      grid-template-columns: repeat(12, minmax(0, 1fr));
      gap: 16px;
    }
    .panel {
      background: linear-gradient(145deg, rgba(18, 29, 58, 0.95), rgba(13, 20, 44, 0.95));
      border: 1px solid var(--card-border);
      border-radius: 16px;
      padding: 16px;
      box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.03), 0 10px 30px rgba(0, 0, 0, 0.25);
      break-inside: avoid;
      page-break-inside: avoid;
    }
    .panel-title {
      margin: 0 0 12px 0;
      font-size: 17px;
      letter-spacing: 0.2px;
    }
    .panel-title-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      margin-bottom: 12px;
      flex-wrap: wrap;
    }
    .panel-title-row .panel-title {
      margin: 0;
    }
    .iso-view-switch {
      display: inline-flex;
      align-items: center;
      gap: 2px;
      padding: 2px;
      border-radius: 999px;
      border: 1px solid rgba(118, 168, 255, 0.3);
      background: rgba(11, 20, 43, 0.86);
    }
    .iso-view-btn {
      border: 0;
      color: #b8cbf0;
      background: transparent;
      border-radius: 999px;
      font-size: 12px;
      font-weight: 700;
      line-height: 1;
      padding: 6px 10px;
      cursor: pointer;
      transition: background 0.2s ease, color 0.2s ease;
    }
    .iso-view-btn.active {
      background: rgba(98, 193, 255, 0.22);
      color: #e9f6ff;
    }
    .metrics-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 10px;
    }
    .metric-card {
      background: rgba(12, 20, 42, 0.9);
      border: 1px solid rgba(109, 161, 255, 0.2);
      border-radius: 13px;
      padding: 12px;
    }
    .metric-label {
      color: var(--text-muted);
      font-size: 12px;
      margin-bottom: 6px;
    }
    .metric-value {
      font-size: 21px;
      font-weight: 700;
      line-height: 1.2;
    }
    .metric-hint {
      margin-top: 4px;
      font-size: 11px;
      color: #8fb1ff;
    }
    .chart {
      width: 100%;
      height: 360px;
    }
    .chart.compact {
      height: 300px;
    }
    .chart.tall {
      height: 420px;
    }
    .chart.heat3d {
      height: 460px;
      position: relative;
      overflow: hidden;
    }
    .chart.heat3d[data-iso-view-mode="both"] {
      height: 540px;
    }
    .iso-stage {
      height: 100%;
      display: flex;
      flex-direction: column;
      gap: 10px;
      min-height: 0;
    }
    .iso-stage[data-iso-view-mode="both"] {
      display: grid;
      grid-template-rows: minmax(240px, 1.7fr) minmax(142px, 1fr);
      gap: 12px;
    }
    .iso-3d-wrap {
      position: relative;
      flex: 1 1 auto;
      min-height: 0;
      overflow: hidden;
    }
    .iso-2d-wrap {
      display: none;
      border: 1px solid rgba(113, 167, 255, 0.22);
      border-radius: 10px;
      background: rgba(9, 16, 36, 0.72);
      padding: 8px;
      min-height: 112px;
    }
    .chart.heat3d[data-iso-view-mode="2d"] .iso-3d-wrap {
      display: none;
    }
    .chart.heat3d[data-iso-view-mode="2d"] .iso-2d-wrap {
      display: block;
      flex: 1 1 auto;
    }
    .chart.heat3d[data-iso-view-mode="2d"] .iso-stats {
      display: none;
    }
    .chart.heat3d[data-iso-view-mode="both"] .iso-3d-wrap,
    .iso-stage[data-iso-view-mode="both"] .iso-3d-wrap {
      min-height: 236px;
    }
    .chart.heat3d[data-iso-view-mode="both"] .iso-2d-wrap,
    .iso-stage[data-iso-view-mode="both"] .iso-2d-wrap {
      display: block;
      min-height: 142px;
    }
    .iso-canvas {
      width: 100%;
      height: 100%;
      display: block;
      image-rendering: pixelated;
      image-rendering: crisp-edges;
    }
    .iso-flat-root {
      height: 100%;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    .iso-flat-months {
      position: relative;
      height: 14px;
      margin-left: 22px;
    }
    .iso-flat-month {
      position: absolute;
      top: 0;
      transform: translateX(-18%);
      color: #8ca7d6;
      font-size: 10px;
      letter-spacing: 0.2px;
      white-space: nowrap;
    }
    .iso-flat-main {
      flex: 1 1 auto;
      display: flex;
      align-items: stretch;
      gap: 6px;
      min-height: 0;
    }
    .iso-flat-days {
      width: 20px;
      display: grid;
      grid-template-rows: repeat(7, 1fr);
      color: #7998cc;
      font-size: 10px;
    }
    .iso-flat-days span {
      align-self: center;
    }
    .iso-flat-grid {
      --week-count: 53;
      flex: 1 1 auto;
      display: grid;
      grid-template-columns: repeat(var(--week-count), minmax(0, 1fr));
      grid-template-rows: repeat(7, minmax(0, 1fr));
      gap: 2px;
      min-height: 96px;
    }
    .iso-flat-cell {
      border-radius: 2px;
      background: rgba(15, 27, 50, 0.9);
      border: 1px solid rgba(60, 88, 134, 0.22);
    }
    .iso-flat-cell.empty {
      opacity: 0.65;
    }
    .iso-flat-legend {
      display: flex;
      justify-content: flex-end;
      align-items: center;
      gap: 6px;
      color: #86a2cf;
      font-size: 10px;
      margin-top: 2px;
    }
    .iso-flat-swatch {
      width: 9px;
      height: 9px;
      border-radius: 2px;
      border: 1px solid rgba(66, 94, 142, 0.32);
    }
    .iso-stats {
      position: absolute;
      right: 10px;
      top: 10px;
      background: rgba(8, 16, 36, 0.76);
      border: 1px solid rgba(120, 166, 255, 0.24);
      border-radius: 10px;
      padding: 8px 10px;
      min-width: 150px;
      font-size: 11px;
      color: #b9ccf6;
      z-index: 2;
      backdrop-filter: blur(2px);
    }
    .iso-stats .big {
      color: #6cf2a0;
      font-size: 20px;
      line-height: 1;
      font-weight: 700;
      margin: 2px 0 4px;
    }
    .iso-stats .row {
      display: flex;
      justify-content: space-between;
      gap: 8px;
      margin-top: 4px;
    }
    .table-wrap {
      overflow-x: auto;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 13px;
      color: #e7eeff;
    }
    th, td {
      padding: 10px;
      border-bottom: 1px solid rgba(129, 165, 255, 0.22);
      text-align: left;
      white-space: nowrap;
    }
    th {
      color: #a8c1ff;
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    .activity-cards {
      display: grid;
      grid-template-columns: 1fr;
      gap: 10px;
    }
    .activity-card {
      border: 1px solid rgba(120, 166, 255, 0.22);
      border-radius: 12px;
      background: rgba(10, 18, 38, 0.84);
      padding: 10px;
    }
    .activity-line {
      display: flex;
      justify-content: space-between;
      gap: 10px;
      align-items: baseline;
    }
    .activity-name {
      font-size: 13px;
      font-weight: 600;
      color: #ecf3ff;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    .activity-date {
      font-size: 11px;
      color: #9fb3de;
      white-space: nowrap;
    }
    .activity-meta {
      margin-top: 7px;
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }
    .activity-pill {
      font-size: 11px;
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid rgba(120, 166, 255, 0.2);
      color: #cfe0ff;
      background: rgba(32, 55, 106, 0.32);
    }
    .compare-row {
      display: grid;
      grid-template-columns: minmax(128px, 0.95fr) minmax(190px, 1.8fr) repeat(3, minmax(180px, 1.1fr));
      gap: 14px;
      align-items: center;
      font-size: 13px;
      padding: 8px 0;
      border-bottom: 1px dashed rgba(116, 152, 235, 0.18);
    }
    .compare-row .compare-cell {
      white-space: nowrap;
    }
    .compare-row .compare-cell.label {
      white-space: normal;
    }
    .compare-row .section {
      color: #8eb9ff;
    }
    .compare-row .pct.pos {
      color: var(--accent-2);
    }
    .compare-row .pct.neg {
      color: var(--accent-danger);
    }
    .compare-cell .cell-tag {
      display: inline-block;
      margin-right: 6px;
      font-size: 10px;
      color: #9fb3de;
      text-transform: uppercase;
      letter-spacing: 0.45px;
    }
    .compare-details {
      margin-top: 8px;
    }
    .compare-details > summary {
      cursor: pointer;
      color: #a9c1ef;
      font-size: 12px;
      margin-bottom: 8px;
      list-style: none;
      user-select: none;
    }
    .compare-details > summary::-webkit-details-marker {
      display: none;
    }
    #compare-rows {
      max-height: 560px;
      overflow-y: auto;
      padding-right: 6px;
    }
    .muted-note {
      color: var(--text-muted);
      font-size: 12px;
    }
    .share-toast {
      position: fixed;
      right: 14px;
      bottom: 14px;
      z-index: 80;
      min-width: 160px;
      max-width: min(80vw, 320px);
      background: rgba(7, 16, 38, 0.95);
      border: 1px solid rgba(104, 158, 255, 0.38);
      color: #e5eeff;
      border-radius: 12px;
      padding: 9px 12px;
      font-size: 12px;
      line-height: 1.4;
      box-shadow: 0 12px 30px rgba(0, 0, 0, 0.34);
      opacity: 0;
      transform: translateY(8px);
      pointer-events: none;
      transition: all 0.22s ease;
    }
    .share-toast.show {
      opacity: 1;
      transform: translateY(0);
    }
    .share-toast.error {
      border-color: rgba(255, 124, 153, 0.55);
      color: #ffd9e4;
    }
    .share-toast.success {
      border-color: rgba(92, 238, 203, 0.55);
      color: #d4fff4;
    }
    .report-shell.exporting section[x-show] {
      display: block !important;
    }
    .report-shell.exporting {
      overflow: visible !important;
      border-radius: 0;
      box-shadow: none;
      max-width: 980px;
      width: 980px;
    }
    .report-shell.exporting .tab-header {
      display: none !important;
    }
    .report-shell.exporting .share-btn {
      display: none !important;
    }
    .report-shell.exporting .section-grid {
      grid-template-columns: 1fr !important;
      gap: 12px;
    }
    .report-shell.exporting .section-grid > .panel {
      grid-column: span 1 !important;
    }
    .report-shell.exporting .chart {
      height: 280px;
    }
    .report-shell.exporting .chart.compact {
      height: 240px;
    }
    .report-shell.exporting .chart.tall {
      height: 320px;
    }
    .report-shell.exporting .chart.heat3d {
      height: 320px;
    }
    .report-shell.exporting .iso-stats {
      display: none;
    }
    .report-shell.exporting .iso-view-switch {
      display: none !important;
    }
    .report-shell.exporting .table-wrap {
      overflow: visible;
    }
    .report-shell.exporting th,
    .report-shell.exporting td {
      white-space: normal;
      word-break: break-word;
    }
    @page {
      size: A4 portrait;
      margin: 8mm;
    }
    @media print {
      html, body {
        -webkit-print-color-adjust: exact;
        print-color-adjust: exact;
      }
      body {
        padding: 0;
        background: #070b16;
        color: var(--text-main);
      }
      .report-shell {
        border: 1px solid rgba(120, 172, 255, 0.2);
        box-shadow: none;
        background: rgba(10, 16, 34, 0.96);
        backdrop-filter: none;
      }
      .tab-header,
      .share-btn {
        display: none !important;
      }
      .section-grid {
        grid-template-columns: 1fr !important;
      }
      .section-grid > .panel {
        grid-column: span 1 !important;
      }
      .chart {
        height: 240px !important;
      }
      .chart.compact {
        height: 220px !important;
      }
      .chart.tall {
        height: 280px !important;
      }
      .chart.heat3d {
        height: 300px !important;
      }
      .iso-stats {
        display: none !important;
      }
      th, td {
        white-space: normal;
        word-break: break-word;
      }
      section[x-show] {
        display: block !important;
      }
    }
    @media (max-width: 1100px) {
      .hero-strips {
        grid-template-columns: repeat(2, minmax(130px, 1fr));
      }
      .compare-row {
        grid-template-columns: minmax(112px, 0.9fr) minmax(170px, 1.5fr) repeat(3, minmax(150px, 1fr));
        gap: 10px;
      }
      #compare-rows {
        max-height: 460px;
      }
    }
    @media (max-width: 760px) {
      body {
        padding: 8px;
      }
      .report-shell {
        border-radius: 14px;
      }
      .hero {
        padding: 16px 14px 12px 14px;
      }
      .hero-title {
        font-size: 26px;
        letter-spacing: 0.3px;
      }
      .hero-subtitle {
        font-size: 12px;
        line-height: 1.45;
      }
      .hero-strips {
        grid-template-columns: 1fr;
      }
      .share-btn {
        width: 100%;
        display: flex;
        justify-content: center;
      }
      .panel-title-row {
        align-items: stretch;
      }
      .iso-view-switch {
        width: 100%;
        justify-content: center;
      }
      .tab-header {
        padding: 10px 10px;
        gap: 8px;
      }
      .tab-button {
        font-size: 13px;
        padding: 7px 12px;
      }
      .content {
        padding: 12px;
      }
      .section-grid {
        grid-template-columns: 1fr;
      }
      .section-grid > .panel {
        grid-column: span 1 !important;
      }
      .metrics-grid {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
      .chart {
        height: 300px;
      }
      .chart.compact {
        height: 270px;
      }
      .chart.tall {
        height: 320px;
      }
      .chart.heat3d {
        height: 340px;
      }
      .chart.heat3d[data-iso-view-mode="both"] {
        height: 460px;
      }
      .iso-stage[data-iso-view-mode="both"] {
        grid-template-rows: minmax(170px, 1.5fr) minmax(132px, 1fr);
        gap: 10px;
      }
      .iso-stats {
        position: static;
        margin-bottom: 8px;
      }
      .table-wrap table {
        font-size: 12px;
      }
      .activity-card {
        padding: 9px;
      }
      .activity-name {
        font-size: 12px;
      }
      .activity-pill {
        font-size: 10px;
      }
      .compare-row {
        grid-template-columns: repeat(3, minmax(0, 1fr));
        gap: 4px;
      }
      .compare-row .compare-cell {
        white-space: normal;
      }
      .compare-row .section,
      .compare-row .label {
        grid-column: span 3;
      }
      #compare-rows {
        max-height: none;
        overflow: visible;
      }
      .share-toast {
        left: 10px;
        right: 10px;
        bottom: 10px;
        max-width: none;
      }
    }
  

  </style>
</head>
<body>
  <div
    class="report-shell"
    x-data="{
      tab: 'overview',
      renderedTabs: { overview: true, sports: false, health: false, compare: false },
      setTab(nextTab) {
        this.tab = nextTab;
        this.renderedTabs[nextTab] = true;
        const u = new URL(window.location.href);
        u.searchParams.set('tab', nextTab);
        history.replaceState(null, '', u.toString());
        window.dispatchEvent(new Event('garmin-tab-change'));
      },
      init() {
        const params = new URLSearchParams(window.location.search);
        const requestedTab = params.get('tab');
        const allowedTabs = ['overview', 'sports', 'health', 'compare'];
        if (allowedTabs.includes(requestedTab)) {
          this.tab = requestedTab;
          this.renderedTabs[requestedTab] = true;
        }
        this.$nextTick(() => window.dispatchEvent(new Event('garmin-tab-change')));
      }
    }"
    x-init="init()"
  >
    <header class="hero">
      <div class="hero-top">
        <h1 class="hero-title">Garmin 2025 年度报告</h1>
        <button id="btn-export-pdf" class="share-btn" type="button">分享 / 打印 PDF</button>
      </div>
      <p class="hero-subtitle">深色科技年度复盘 | 数据来源 analyze_report_data.json | 生成时间 2026-02-10</p>
      <div class="hero-strips">
        <div class="hero-chip"><div class="label">活动总数</div><div class="value" id="hero-total-activities">-</div></div>
        <div class="hero-chip"><div class="label">年度总距离</div><div class="value" id="hero-total-distance">-</div></div>
        <div class="hero-chip"><div class="label">年度总时长</div><div class="value" id="hero-total-duration">-</div></div>
      </div>
    </header>

    <div class="tab-header">
      <button class="tab-button" :class="{ 'active': tab === 'overview' }" @click="setTab('overview')">概览总览</button>
      <button class="tab-button" :class="{ 'active': tab === 'sports' }" @click="setTab('sports')">运动分析</button>
      <button class="tab-button" :class="{ 'active': tab === 'health' }" @click="setTab('health')">健康洞察</button>
      <button class="tab-button" :class="{ 'active': tab === 'compare' }" @click="setTab('compare')">年度对比</button>
    </div>

    <main class="content">
      <section x-show="tab === 'overview'" x-cloak>
        <div class="section-grid">
          <div class="panel" style="grid-column: span 12;">
            <h2 class="panel-title">核心指标</h2>
            <div id="overview-kpis" class="metrics-grid"></div>
          </div>
          <div class="panel" style="grid-column: span 8;">
            <h2 class="panel-title">月度里程与活动次数</h2>
            <div id="chart-overview-monthly" class="chart"></div>
          </div>
          <div class="panel" style="grid-column: span 4;">
            <h2 class="panel-title">运动类型分布</h2>
            <div id="chart-sport-type-pie" class="chart"></div>
          </div>
          <div class="panel" style="grid-column: span 4;">
            <h2 class="panel-title">按运动类型划分的卡路里消耗分布</h2>
            <div id="chart-overview-type-calories" class="chart compact"></div>
          </div>
          <div class="panel" style="grid-column: span 4;">
            <h2 class="panel-title">按运动类型划分的运动时长分布</h2>
            <div id="chart-overview-type-duration" class="chart compact"></div>
          </div>
          <div class="panel" style="grid-column: span 4;">
            <h2 class="panel-title">按运动类型划分的强度活动时间分布</h2>
            <div id="chart-overview-type-intensity" class="chart compact"></div>
          </div>
        </div>
      </section>

      <section x-show="tab === 'sports'" x-cloak>
        <div class="section-grid">
          <div class="panel" style="grid-column: span 12;">
            <h2 class="panel-title">跑步与游泳关键数据</h2>
            <div id="sports-kpis" class="metrics-grid"></div>
          </div>
          <div class="panel" style="grid-column: span 8;">
            <h2 class="panel-title">运动类型多维分析（次数 / 时长 / 距离）</h2>
            <div id="chart-sport-matrix" class="chart tall"></div>
          </div>
          <div class="panel" style="grid-column: span 4;">
            <h2 class="panel-title">运动类型卡路里占比</h2>
            <div id="chart-sport-calories" class="chart tall"></div>
          </div>
          <div class="panel" style="grid-column: span 6;">
            <h2 class="panel-title">Top 5 跑步</h2>
            <div id="table-running" class="table-wrap"></div>
          </div>
          <div class="panel" style="grid-column: span 6;">
            <h2 class="panel-title">Top 5 游泳</h2>
            <div id="table-swimming" class="table-wrap"></div>
          </div>
          <div class="panel" style="grid-column: span 12;">
            <h2 class="panel-title">每周强度活动目标与达成（目标 200 分钟）</h2>
            <div id="chart-sports-weekly-intensity-goal" class="chart"></div>
          </div>
          <div class="panel" style="grid-column: span 12;">
            <div class="panel-title-row">
              <h2 class="panel-title">365 天每日卡路里消耗（3D 热力柱）</h2>
              <div class="iso-view-switch" data-iso-toggle-group>
                <button type="button" class="iso-view-btn" data-iso-mode="2d">2D</button>
                <button type="button" class="iso-view-btn" data-iso-mode="3d">3D</button>
                <button type="button" class="iso-view-btn" data-iso-mode="both">Both</button>
              </div>
            </div>
            <div id="chart-sports-daily-calories-3d" class="chart heat3d" data-iso-view-mode="both"></div>
          </div>
          <div class="panel" style="grid-column: span 12;">
            <div class="panel-title-row">
              <h2 class="panel-title">365 天每日运动时长（3D 热力柱）</h2>
              <div class="iso-view-switch" data-iso-toggle-group>
                <button type="button" class="iso-view-btn" data-iso-mode="2d">2D</button>
                <button type="button" class="iso-view-btn" data-iso-mode="3d">3D</button>
                <button type="button" class="iso-view-btn" data-iso-mode="both">Both</button>
              </div>
            </div>
            <div id="chart-sports-daily-duration-3d" class="chart heat3d" data-iso-view-mode="both"></div>
          </div>
        </div>
      </section>

      <section x-show="tab === 'health'" x-cloak>
        <div class="section-grid">
          <div class="panel" style="grid-column: span 12;">
            <h2 class="panel-title">健康概览</h2>
            <div id="health-kpis" class="metrics-grid"></div>
          </div>
          <div class="panel" style="grid-column: span 12;">
            <h2 class="panel-title">月度步数与睡眠时长</h2>
            <div id="chart-health-monthly" class="chart"></div>
          </div>
          <div class="panel" style="grid-column: span 4;">
            <h2 class="panel-title">体重变化</h2>
            <div id="chart-health-weight-trend" class="chart compact"></div>
          </div>
          <div class="panel" style="grid-column: span 4;">
            <h2 class="panel-title">身体年龄变化记录</h2>
            <div id="chart-health-body-age-trend" class="chart compact"></div>
          </div>
          <div class="panel" style="grid-column: span 4;">
            <h2 class="panel-title">静息心率变化</h2>
            <div id="chart-health-resting-hr-trend" class="chart compact"></div>
          </div>
        </div>
      </section>

      <section x-show="tab === 'compare'" x-cloak>
        <div class="section-grid">
          <div class="panel" style="grid-column: span 12;">
            <h2 class="panel-title">同比变化明细</h2>
            <details id="compare-details" class="compare-details" open>
              <summary>点击展开/收起同比明细</summary>
              <div id="compare-rows"></div>
            </details>
          </div>
          <div class="panel" style="grid-column: span 12;">
            <h2 class="panel-title">月度里程对比（2025 vs 2024）</h2>
            <div id="chart-compare-monthly" class="chart"></div>
          </div>
          <div class="panel" style="grid-column: span 12;">
            <h2 class="panel-title">Top 10 年度活动</h2>
            <div id="table-top-activities" class="table-wrap"></div>
          </div>
        </div>
      </section>
    </main>
  </div>
  <div id="share-toast" class="share-toast" aria-live="polite"></div>

  <script>
    window.REPORT_DATA = {"year": 2025, "previous_year": 2024, "generated_at": "2026-02-10", "meta": {"year": 2025, "generated_at": "2026-02-10 16:44:46", "schema_version": "1.0", "input_data_root": "/Users/shaolongfei/PycharmProjects/GarminReport/garmin_report_2025/data", "sources": [{"method": "get_activities", "section": "activities_workouts", "path": "data/activities_workouts/get_activities.json", "exists": true, "status": "success", "records_used": 147}, {"method": "get_user_summary", "section": "daily_health_activity", "path": "data/daily_health_activity/get_user_summary.json", "exists": true, "status": "success", "records_used": 365}, {"method": "get_sleep_data", "section": "daily_health_activity", "path": "data/daily_health_activity/get_sleep_data.json", "exists": true, "status": "success", "records_used": 365}, {"method": "get_hrv_data", "section": "advanced_health_metrics", "path": "data/advanced_health_metrics/get_hrv_data.json", "exists": true, "status": "success", "records_used": 359}, {"method": "get_all_day_stress", "section": "daily_health_activity", "path": "data/daily_health_activity/get_all_day_stress.json", "exists": true, "status": "success", "records_used": 365}, {"method": "get_respiration_data", "section": "advanced_health_metrics", "path": "data/advanced_health_metrics/get_respiration_data.json", "exists": true, "status": "success", "records_used": 365}, {"method": "get_daily_weigh_ins", "section": "body_composition_weight", "path": "data/body_composition_weight/get_daily_weigh_ins.json", "exists": true, "status": "success", "records_used": 365}], "previous_year_comparison": {"previous_year": 2024, "available": true}}, "activity_overview": {"total_activities": 147, "active_days": 115, "total_distance_m": 134786.621, "total_duration_s": 624795.511, "total_calories": 90885.0, "total_elevation_gain_m": 193.0, "longest_activity": {"activity_id": 504891715, "activity_name": "羽毛球", "type_key": "badminton", "date": "2025-08-04", "duration_s": 10014.606}, "longest_distance_activity": {"activity_id": 469942596, "activity_name": "浦东新区 跑步", "type_key": "running", "date": "2025-04-20", "distance_m": 21567.551}, "top_activities_by_duration": [{"activity_id": 504891715, "activity_name": "羽毛球", "type_key": "badminton", "date": "2025-08-04", "distance_m": 541.19, "duration_s": 10014.606, "calories": 1475.0}, {"activity_id": 541935977, "activity_name": "羽毛球", "type_key": "badminton", "date": "2025-11-23", "distance_m": 481.92, "duration_s": 9578.593, "calories": 1689.0}, {"activity_id": 490779176, "activity_name": "羽毛球", "type_key": "badminton", "date": "2025-06-23", "distance_m": 691.17, "duration_s": 9028.042, "calories": 1680.0}, {"activity_id": 485687400, "activity_name": "羽毛球", "type_key": "badminton", "date": "2025-06-08", "distance_m": 440.75, "duration_s": 8753.285, "calories": 1491.0}, {"activity_id": 492462787, "activity_name": "羽毛球", "type_key": "badminton", "date": "2025-06-28", "distance_m": 601.85, "duration_s": 8704.924, "calories": 1452.0}, {"activity_id": 487961359, "activity_name": "羽毛球", "type_key": "badminton", "date": "2025-06-15", "distance_m": 622.77, "duration_s": 8428.153, "calories": 1074.0}, {"activity_id": 543587775, "activity_name": "羽毛球", "type_key": "badminton", "date": "2025-11-29", "distance_m": 635.95, "duration_s": 8384.663, "calories": 1346.0}, {"activity_id": 465115163, "activity_name": "羽毛球", "type_key": "badminton", "date": "2025-04-04", "distance_m": 707.01, "duration_s": 8233.157, "calories": 1113.0}, {"activity_id": 450124065, "activity_name": "羽毛球", "type_key": "badminton", "date": "2025-02-06", "distance_m": 387.7, "duration_s": 7970.536, "calories": 860.0}, {"activity_id": 449451354, "activity_name": "羽毛球", "type_key": "badminton", "date": "2025-02-03", "distance_m": 423.17, "duration_s": 7935.515, "calories": 1284.0}], "change_vs_previous_year": {"total_activities": {"delta": -376.0, "pct_change": -71.893, "previous": 523.0, "current": 147.0}, "active_days": {"delta": -140.0, "pct_change": -54.902, "previous": 255.0, "current": 115.0}, "total_distance_m": {"delta": -1087335.951, "pct_change": -88.971, "previous": 1222122.572, "current": 134786.621}, "total_duration_s": {"delta": -917693.363, "pct_change": -59.494, "previous": 1542488.874, "current": 624795.511}, "total_calories": {"delta": -125859.0, "pct_change": -58.068, "previous": 216744.0, "current": 90885.0}, "total_elevation_gain_m": {"delta": -2216.0, "pct_change": -91.988, "previous": 2409.0, "current": 193.0}}}, "health_overview": {"days_in_year": 365, "daily_summary_days": 365, "sleep_recorded_days": 354, "total_steps": 2509196, "avg_daily_steps": 6874.51, "total_distance_m": 1899798.0, "avg_resting_heart_rate": 43.37, "total_active_kcal": 123375.0, "total_moderate_intensity_minutes": 3358.0, "total_vigorous_intensity_minutes": 2007.0, "total_intensity_minutes": 7372.0, "avg_daily_intensity_minutes": 20.197, "avg_sleep_hours": 7.377, "avg_sleep_score": 82.205, "avg_deep_sleep_hours": 1.331, "avg_light_sleep_hours": 4.711, "avg_rem_sleep_hours": 1.336, "change_vs_previous_year": {"days_in_year": {"delta": -1.0, "pct_change": -0.273, "previous": 366.0, "current": 365.0}, "daily_summary_days": {"delta": -1.0, "pct_change": -0.273, "previous": 366.0, "current": 365.0}, "sleep_recorded_days": {"delta": -4.0, "pct_change": -1.117, "previous": 358.0, "current": 354.0}, "total_steps": {"delta": -461101.0, "pct_change": -15.524, "previous": 2970297.0, "current": 2509196.0}, "avg_daily_steps": {"delta": -1241.056, "pct_change": -15.292, "previous": 8115.566, "current": 6874.51}, "total_distance_m": {"delta": -989173.0, "pct_change": -34.24, "previous": 2888971.0, "current": 1899798.0}, "avg_resting_heart_rate": {"delta": -0.529, "pct_change": -1.205, "previous": 43.899, "current": 43.37}, "total_active_kcal": {"delta": -114836.0, "pct_change": -48.208, "previous": 238211.0, "current": 123375.0}, "total_moderate_intensity_minutes": {"delta": -2979.0, "pct_change": -47.01, "previous": 6337.0, "current": 3358.0}, "total_vigorous_intensity_minutes": {"delta": -1296.0, "pct_change": -39.237, "previous": 3303.0, "current": 2007.0}, "avg_sleep_hours": {"delta": -0.084, "pct_change": -1.126, "previous": 7.461, "current": 7.377}, "avg_deep_sleep_hours": {"delta": -0.008, "pct_change": -0.597, "previous": 1.339, "current": 1.331}, "avg_light_sleep_hours": {"delta": 0.027, "pct_change": 0.576, "previous": 4.684, "current": 4.711}, "avg_rem_sleep_hours": {"delta": -0.103, "pct_change": -7.158, "previous": 1.439, "current": 1.336}}}, "health_advanced": {"hrv": {"days": 359, "avg": 84.189, "min": 53.0, "max": 118.0, "change_vs_previous_year": {"days": {"delta": -7.0, "pct_change": -1.913, "previous": 366.0, "current": 359.0}, "avg": {"delta": 10.369, "pct_change": 14.046, "previous": 73.82, "current": 84.189}, "min": {"delta": 25.0, "pct_change": 89.286, "previous": 28.0, "current": 53.0}, "max": {"delta": 9.0, "pct_change": 8.257, "previous": 109.0, "current": 118.0}}}, "stress": {"days": 363, "avg_daily_stress": 27.11, "max_stress_peak": 99.0, "change_vs_previous_year": {"days": {"delta": -3.0, "pct_change": -0.82, "previous": 366.0, "current": 363.0}, "avg_daily_stress": {"delta": -0.986, "pct_change": -3.509, "previous": 28.096, "current": 27.11}, "max_stress_peak": {"delta": 0.0, "pct_change": 0.0, "previous": 99.0, "current": 99.0}}}, "respiration": {"days": 353, "avg_sleep_respiration": 13.292, "change_vs_previous_year": {"days": {"delta": -5.0, "pct_change": -1.397, "previous": 358.0, "current": 353.0}, "avg_sleep_respiration": {"delta": -0.099, "pct_change": -0.739, "previous": 13.391, "current": 13.292}}}}, "sports": {"running": {"count": 15, "total_distance_m": 96700.061, "total_duration_s": 37157.168, "total_calories": 6717.0, "avg_pace_min_per_km": 6.404, "longest_distance_m": 21567.551, "longest_duration_s": 7169.594, "avg_heart_rate": 136.733, "top_activities_by_duration": [{"activity_id": 469942596, "activity_name": "浦东新区 跑步", "type_key": "running", "date": "2025-04-20", "distance_m": 21567.551, "duration_s": 7169.594, "calories": 1542.0}, {"activity_id": 442793062, "activity_name": "嘉定区 跑步", "type_key": "running", "date": "2025-01-01", "distance_m": 21497.84, "duration_s": 7143.676, "calories": 1674.0}, {"activity_id": 472843655, "activity_name": "跑步机", "type_key": "treadmill_running", "date": "2025-04-29", "distance_m": 7186.93, "duration_s": 2764.333, "calories": 309.0}, {"activity_id": 467595551, "activity_name": "浦东新区 跑步", "type_key": "running", "date": "2025-04-12", "distance_m": 5486.07, "duration_s": 2630.807, "calories": 386.0}, {"activity_id": 467717958, "activity_name": "浦东新区 跑步", "type_key": "running", "date": "2025-04-13", "distance_m": 5245.4, "duration_s": 2335.606, "calories": 378.0}], "change_vs_previous_year": {"count": {"delta": -36.0, "pct_change": -70.588, "previous": 51.0, "current": 15.0}, "total_distance_m": {"delta": -210766.431, "pct_change": -68.549, "previous": 307466.492, "current": 96700.061}, "total_duration_s": {"delta": -97477.557, "pct_change": -72.401, "previous": 134634.725, "current": 37157.168}, "total_calories": {"delta": -16270.0, "pct_change": -70.779, "previous": 22987.0, "current": 6717.0}, "avg_pace_min_per_km": {"delta": -0.894, "pct_change": -12.25, "previous": 7.298, "current": 6.404}, "longest_distance_m": {"delta": 10.201, "pct_change": 0.047, "previous": 21557.35, "current": 21567.551}, "longest_duration_s": {"delta": 184.423, "pct_change": 2.64, "previous": 6985.171, "current": 7169.594}, "avg_heart_rate": {"delta": -0.287, "pct_change": -0.209, "previous": 137.02, "current": 136.733}}}, "swimming": {"count": 9, "total_distance_m": 12475.0, "total_duration_s": 28707.48, "total_calories": 2406.0, "avg_pace_min_per_km": 38.353, "longest_distance_m": 2025.0, "longest_duration_s": 5322.261, "avg_heart_rate": 97.0, "top_activities_by_duration": [{"activity_id": 449587047, "activity_name": "泳池游泳", "type_key": "lap_swimming", "date": "2025-02-04", "distance_m": 1750.0, "duration_s": 5322.261, "calories": 365.0}, {"activity_id": 454776263, "activity_name": "泳池游泳", "type_key": "lap_swimming", "date": "2025-02-26", "distance_m": 2025.0, "duration_s": 4198.711, "calories": 504.0}, {"activity_id": 472644118, "activity_name": "泳池游泳", "type_key": "lap_swimming", "date": "2025-04-28", "distance_m": 1700.0, "duration_s": 3699.332, "calories": 231.0}, {"activity_id": 468492493, "activity_name": "泳池游泳", "type_key": "lap_swimming", "date": "2025-04-15", "distance_m": 1600.0, "duration_s": 3674.809, "calories": 276.0}, {"activity_id": 453118092, "activity_name": "泳池游泳", "type_key": "lap_swimming", "date": "2025-02-19", "distance_m": 1525.0, "duration_s": 3347.28, "calories": 362.0}], "avg_pace_min_per_100m": 3.835, "change_vs_previous_year": {"count": {"delta": -18.0, "pct_change": -66.667, "previous": 27.0, "current": 9.0}, "total_distance_m": {"delta": -30567.44, "pct_change": -71.017, "previous": 43042.44, "current": 12475.0}, "total_duration_s": {"delta": -96606.505, "pct_change": -77.092, "previous": 125313.985, "current": 28707.48}, "total_calories": {"delta": -11197.0, "pct_change": -82.313, "previous": 13603.0, "current": 2406.0}, "avg_pace_min_per_km": {"delta": -10.17, "pct_change": -20.959, "previous": 48.523, "current": 38.353}, "longest_distance_m": {"delta": -352.44, "pct_change": -14.824, "previous": 2377.44, "current": 2025.0}, "longest_duration_s": {"delta": -4205.777, "pct_change": -44.141, "previous": 9528.038, "current": 5322.261}, "avg_heart_rate": {"delta": -11.963, "pct_change": -10.979, "previous": 108.963, "current": 97.0}, "avg_pace_min_per_100m": {"delta": -1.017, "pct_change": -20.96, "previous": 4.852, "current": 3.835}}}, "type_analysis": {"labels": ["羽毛球", "力量训练", "跑步", "有氧训练", "游泳", "跑步机跑步", "乒乓球"], "by_count": [65.0, 45.0, 13.0, 12.0, 9.0, 2.0, 1.0], "by_duration_h": [108.0889538888889, 35.09841166666667, 8.93196111111111, 11.665660555555554, 7.9742999999999995, 1.3894744444444445, 0.40554694444444445], "by_calories": [67182.0, 10775.0, 6187.0, 3707.0, 2406.0, 530.0, 98.0], "by_distance_km": [25.542270000000002, 0.0, 84.238641, 0.0, 12.475, 12.46142, 0.06929], "by_intensity_minutes": [5449.367, 873.998, 501.849, 300.688, 195.159, 42.99, 7.949], "display_names_zh": {"badminton": "羽毛球", "strength_training": "力量训练", "lap_swimming": "游泳", "running": "跑步", "table_tennis": "乒乓球", "indoor_cardio": "有氧训练", "treadmill_running": "跑步机跑步"}}}, "monthly_trends": {"labels": ["01", "02", "03", "04", "05", "06", "07", "08", "09", "10", "11", "12"], "distance_km": [21.498, 7.727, 10.933, 72.133, 3.147, 3.216, 2.529, 5.917, 2.209, 1.302, 3.793, 0.383], "activity_count": [1.0, 18.0, 13.0, 36.0, 12.0, 18.0, 12.0, 17.0, 7.0, 3.0, 9.0, 1.0], "steps_by_month": [234226.0, 181088.0, 196274.0, 300315.0, 225203.0, 203966.0, 214570.0, 279830.0, 241379.0, 200140.0, 188377.0, 43828.0], "sleep_hours_by_month": [190.67, 172.719, 233.09, 223.654, 230.154, 212.087, 230.506, 219.529, 218.983, 229.134, 226.571, 224.294]}, "daily_trends": {"duration_h_by_date": {"2025-01-01": 1.984, "2025-02-03": 2.204, "2025-02-04": 2.839, "2025-02-06": 2.214, "2025-02-15": 1.976, "2025-02-16": 1.879, "2025-02-19": 0.93, "2025-02-21": 0.656, "2025-02-22": 3.082, "2025-02-23": 1.741, "2025-02-25": 0.833, "2025-02-26": 2.078, "2025-02-27": 2.596, "2025-03-02": 1.525, "2025-03-08": 1.601, "2025-03-13": 1.674, "2025-03-16": 2.67, "2025-03-22": 2.035, "2025-03-25": 2.158, "2025-03-27": 0.259, "2025-03-28": 2.044, "2025-03-29": 1.732, "2025-03-31": 0.778, "2025-04-01": 2.386, "2025-04-02": 0.741, "2025-04-03": 0.778, "2025-04-04": 2.287, "2025-04-05": 0.137, "2025-04-06": 1.259, "2025-04-07": 0.834, "2025-04-08": 2.59, "2025-04-10": 0.489, "2025-04-12": 0.731, "2025-04-13": 1.731, "2025-04-14": 1.288, "2025-04-15": 2.101, "2025-04-16": 0.602, "2025-04-17": 1.126, "2025-04-18": 0.647, "2025-04-20": 1.992, "2025-04-22": 0.615, "2025-04-24": 2.365, "2025-04-25": 1.576, "2025-04-26": 1.499, "2025-04-28": 1.67, "2025-04-29": 0.768, "2025-04-30": 0.622, "2025-05-06": 0.431, "2025-05-07": 0.679, "2025-05-15": 0.481, "2025-05-16": 1.498, "2025-05-17": 1.995, "2025-05-22": 0.636, "2025-05-24": 1.743, "2025-05-26": 1.339, "2025-05-27": 2.507, "2025-06-05": 0.695, "2025-06-06": 1.555, "2025-06-08": 2.431, "2025-06-09": 0.776, "2025-06-12": 1.087, "2025-06-15": 2.341, "2025-06-16": 1.518, "2025-06-17": 1.391, "2025-06-18": 1.026, "2025-06-19": 1.09, "2025-06-21": 2.032, "2025-06-23": 2.508, "2025-06-24": 1.011, "2025-06-25": 1.071, "2025-06-28": 2.418, "2025-06-29": 0.406, "2025-07-01": 0.977, "2025-07-02": 1.115, "2025-07-03": 0.972, "2025-07-04": 1.147, "2025-07-05": 1.585, "2025-07-17": 0.941, "2025-07-25": 1.574, "2025-07-26": 1.607, "2025-07-27": 1.647, "2025-07-30": 2.67, "2025-08-04": 2.782, "2025-08-05": 1.277, "2025-08-14": 0.083, "2025-08-15": 1.36, "2025-08-16": 1.564, "2025-08-17": 2.023, "2025-08-18": 0.722, "2025-08-20": 1.221, "2025-08-21": 1.337, "2025-08-22": 1.565, "2025-08-23": 2.483, "2025-08-26": 1.236, "2025-08-27": 1.77, "2025-09-03": 1.442, "2025-09-04": 1.658, "2025-09-11": 0.881, "2025-09-17": 1.156, "2025-09-21": 1.809, "2025-09-22": 1.201, "2025-09-27": 1.632, "2025-10-12": 2.087, "2025-10-19": 1.929, "2025-10-25": 2.042, "2025-11-01": 1.505, "2025-11-02": 1.456, "2025-11-08": 1.553, "2025-11-16": 1.782, "2025-11-21": 0.87, "2025-11-23": 2.661, "2025-11-27": 1.052, "2025-11-29": 2.329, "2025-11-30": 2.181, "2025-12-03": 1.686}, "calories_by_date": {"2025-01-01": 1674.0, "2025-02-03": 1284.0, "2025-02-04": 1268.0, "2025-02-06": 860.0, "2025-02-15": 1027.0, "2025-02-16": 595.0, "2025-02-19": 362.0, "2025-02-21": 168.0, "2025-02-22": 1346.0, "2025-02-23": 471.0, "2025-02-25": 231.0, "2025-02-26": 778.0, "2025-02-27": 1599.0, "2025-03-02": 531.0, "2025-03-08": 526.0, "2025-03-13": 935.0, "2025-03-16": 571.0, "2025-03-22": 1018.0, "2025-03-25": 1506.0, "2025-03-27": 169.0, "2025-03-28": 1315.0, "2025-03-29": 862.0, "2025-03-31": 175.0, "2025-04-01": 1417.0, "2025-04-02": 217.0, "2025-04-03": 228.0, "2025-04-04": 1113.0, "2025-04-05": 69.0, "2025-04-06": 823.0, "2025-04-07": 285.0, "2025-04-08": 1219.0, "2025-04-10": 188.0, "2025-04-12": 386.0, "2025-04-13": 687.0, "2025-04-14": 529.0, "2025-04-15": 878.0, "2025-04-16": 422.0, "2025-04-17": 612.0, "2025-04-18": 162.0, "2025-04-20": 1542.0, "2025-04-22": 173.0, "2025-04-24": 1341.0, "2025-04-25": 488.0, "2025-04-26": 662.0, "2025-04-28": 414.0, "2025-04-29": 309.0, "2025-04-30": 221.0, "2025-05-06": 163.0, "2025-05-07": 265.0, "2025-05-15": 147.0, "2025-05-16": 1086.0, "2025-05-17": 909.0, "2025-05-22": 178.0, "2025-05-24": 1164.0, "2025-05-26": 408.0, "2025-05-27": 1530.0, "2025-06-05": 202.0, "2025-06-06": 588.0, "2025-06-08": 1491.0, "2025-06-09": 247.0, "2025-06-12": 379.0, "2025-06-15": 1074.0, "2025-06-16": 556.0, "2025-06-17": 965.0, "2025-06-18": 344.0, "2025-06-19": 371.0, "2025-06-21": 1385.0, "2025-06-23": 1680.0, "2025-06-24": 241.0, "2025-06-25": 343.0, "2025-06-28": 1452.0, "2025-06-29": 98.0, "2025-07-01": 236.0, "2025-07-02": 372.0, "2025-07-03": 797.0, "2025-07-04": 259.0, "2025-07-05": 1033.0, "2025-07-17": 762.0, "2025-07-25": 1179.0, "2025-07-26": 1090.0, "2025-07-27": 936.0, "2025-07-30": 1888.0, "2025-08-04": 1475.0, "2025-08-05": 719.0, "2025-08-14": 43.0, "2025-08-15": 945.0, "2025-08-16": 1022.0, "2025-08-17": 1393.0, "2025-08-18": 195.0, "2025-08-20": 303.0, "2025-08-21": 329.0, "2025-08-22": 425.0, "2025-08-23": 1718.0, "2025-08-26": 378.0, "2025-08-27": 871.0, "2025-09-03": 425.0, "2025-09-04": 1167.0, "2025-09-11": 604.0, "2025-09-17": 885.0, "2025-09-21": 1126.0, "2025-09-22": 870.0, "2025-09-27": 1223.0, "2025-10-12": 1458.0, "2025-10-19": 1118.0, "2025-10-25": 1539.0, "2025-11-01": 1116.0, "2025-11-02": 824.0, "2025-11-08": 1043.0, "2025-11-16": 1426.0, "2025-11-21": 659.0, "2025-11-23": 1689.0, "2025-11-27": 831.0, "2025-11-29": 1346.0, "2025-11-30": 1315.0, "2025-12-03": 931.0}, "intensity_minutes_by_date": {"2025-01-01": 230.0, "2025-01-02": 0.0, "2025-01-03": 0.0, "2025-01-04": 0.0, "2025-01-05": 0.0, "2025-01-06": 0.0, "2025-01-07": 0.0, "2025-01-08": 0.0, "2025-01-09": 0.0, "2025-01-10": 0.0, "2025-01-11": 0.0, "2025-01-12": 0.0, "2025-01-13": 0.0, "2025-01-14": 0.0, "2025-01-15": 0.0, "2025-01-16": 0.0, "2025-01-17": 0.0, "2025-01-18": 0.0, "2025-01-19": 0.0, "2025-01-20": 0.0, "2025-01-21": 0.0, "2025-01-22": 0.0, "2025-01-23": 0.0, "2025-01-24": 0.0, "2025-01-25": 0.0, "2025-01-26": 0.0, "2025-01-27": 8.0, "2025-01-28": 0.0, "2025-01-29": 0.0, "2025-01-30": 0.0, "2025-01-31": 0.0, "2025-02-01": 0.0, "2025-02-02": 0.0, "2025-02-03": 139.0, "2025-02-04": 73.0, "2025-02-05": 0.0, "2025-02-06": 0.0, "2025-02-07": 0.0, "2025-02-08": 11.0, "2025-02-09": 0.0, "2025-02-10": 0.0, "2025-02-11": 0.0, "2025-02-12": 0.0, "2025-02-13": 0.0, "2025-02-14": 0.0, "2025-02-15": 81.0, "2025-02-16": 0.0, "2025-02-17": 0.0, "2025-02-18": 0.0, "2025-02-19": 0.0, "2025-02-20": 0.0, "2025-02-21": 4.0, "2025-02-22": 15.0, "2025-02-23": 0.0, "2025-02-24": 0.0, "2025-02-25": 0.0, "2025-02-26": 0.0, "2025-02-27": 160.0, "2025-02-28": 0.0, "2025-03-01": 0.0, "2025-03-02": 0.0, "2025-03-03": 0.0, "2025-03-04": 0.0, "2025-03-05": 0.0, "2025-03-06": 0.0, "2025-03-07": 0.0, "2025-03-08": 0.0, "2025-03-09": 0.0, "2025-03-10": 0.0, "2025-03-11": 0.0, "2025-03-12": 0.0, "2025-03-13": 66.0, "2025-03-14": 0.0, "2025-03-15": 0.0, "2025-03-16": 4.0, "2025-03-17": 0.0, "2025-03-18": 0.0, "2025-03-19": 0.0, "2025-03-20": 0.0, "2025-03-21": 0.0, "2025-03-22": 42.0, "2025-03-23": 0.0, "2025-03-24": 0.0, "2025-03-25": 168.0, "2025-03-26": 0.0, "2025-03-27": 10.0, "2025-03-28": 138.0, "2025-03-29": 53.0, "2025-03-30": 0.0, "2025-03-31": 0.0, "2025-04-01": 141.0, "2025-04-02": 0.0, "2025-04-03": 0.0, "2025-04-04": 75.0, "2025-04-05": 0.0, "2025-04-06": 76.0, "2025-04-07": 0.0, "2025-04-08": 59.0, "2025-04-09": 0.0, "2025-04-10": 0.0, "2025-04-11": 0.0, "2025-04-12": 0.0, "2025-04-13": 12.0, "2025-04-14": 0.0, "2025-04-15": 27.0, "2025-04-16": 35.0, "2025-04-17": 31.0, "2025-04-18": 0.0, "2025-04-19": 0.0, "2025-04-20": 188.0, "2025-04-21": 0.0, "2025-04-22": 0.0, "2025-04-23": 0.0, "2025-04-24": 110.0, "2025-04-25": 0.0, "2025-04-26": 16.0, "2025-04-27": 0.0, "2025-04-28": 0.0, "2025-04-29": 6.0, "2025-04-30": 13.0, "2025-05-01": 0.0, "2025-05-02": 0.0, "2025-05-03": 0.0, "2025-05-04": 0.0, "2025-05-05": 0.0, "2025-05-06": 0.0, "2025-05-07": 0.0, "2025-05-08": 0.0, "2025-05-09": 0.0, "2025-05-10": 0.0, "2025-05-11": 0.0, "2025-05-12": 0.0, "2025-05-13": 0.0, "2025-05-14": 0.0, "2025-05-15": 0.0, "2025-05-16": 127.0, "2025-05-17": 22.0, "2025-05-18": 0.0, "2025-05-19": 0.0, "2025-05-20": 0.0, "2025-05-21": 0.0, "2025-05-22": 0.0, "2025-05-23": 0.0, "2025-05-24": 142.0, "2025-05-25": 0.0, "2025-05-26": 0.0, "2025-05-27": 163.0, "2025-05-28": 0.0, "2025-05-29": 0.0, "2025-05-30": 0.0, "2025-05-31": 0.0, "2025-06-01": 0.0, "2025-06-02": 0.0, "2025-06-03": 0.0, "2025-06-04": 0.0, "2025-06-05": 0.0, "2025-06-06": 13.0, "2025-06-07": 0.0, "2025-06-08": 162.0, "2025-06-09": 0.0, "2025-06-10": 0.0, "2025-06-11": 0.0, "2025-06-12": 0.0, "2025-06-13": 0.0, "2025-06-14": 0.0, "2025-06-15": 48.0, "2025-06-16": 10.0, "2025-06-17": 111.0, "2025-06-18": 0.0, "2025-06-19": 7.0, "2025-06-20": 0.0, "2025-06-21": 153.0, "2025-06-22": 0.0, "2025-06-23": 219.0, "2025-06-24": 0.0, "2025-06-25": 0.0, "2025-06-26": 0.0, "2025-06-27": 0.0, "2025-06-28": 137.0, "2025-06-29": 0.0, "2025-06-30": 0.0, "2025-07-01": 0.0, "2025-07-02": 0.0, "2025-07-03": 111.0, "2025-07-04": 0.0, "2025-07-05": 106.0, "2025-07-06": 0.0, "2025-07-07": 0.0, "2025-07-08": 0.0, "2025-07-09": 0.0, "2025-07-10": 0.0, "2025-07-11": 0.0, "2025-07-12": 0.0, "2025-07-13": 0.0, "2025-07-14": 0.0, "2025-07-15": 0.0, "2025-07-16": 0.0, "2025-07-17": 104.0, "2025-07-18": 0.0, "2025-07-19": 0.0, "2025-07-20": 0.0, "2025-07-21": 0.0, "2025-07-22": 0.0, "2025-07-23": 0.0, "2025-07-24": 0.0, "2025-07-25": 126.0, "2025-07-26": 111.0, "2025-07-27": 80.0, "2025-07-28": 0.0, "2025-07-29": 0.0, "2025-07-30": 214.0, "2025-07-31": 0.0, "2025-08-01": 0.0, "2025-08-02": 0.0, "2025-08-03": 0.0, "2025-08-04": 148.0, "2025-08-05": 34.0, "2025-08-06": 0.0, "2025-08-07": 0.0, "2025-08-08": 0.0, "2025-08-09": 0.0, "2025-08-10": 0.0, "2025-08-11": 0.0, "2025-08-12": 0.0, "2025-08-13": 0.0, "2025-08-14": 0.0, "2025-08-15": 99.0, "2025-08-16": 107.0, "2025-08-17": 183.0, "2025-08-18": 0.0, "2025-08-19": 0.0, "2025-08-20": 0.0, "2025-08-21": 0.0, "2025-08-22": 0.0, "2025-08-23": 178.0, "2025-08-24": 0.0, "2025-08-25": 0.0, "2025-08-26": 2.0, "2025-08-27": 61.0, "2025-08-28": 0.0, "2025-08-29": 0.0, "2025-08-30": 0.0, "2025-08-31": 0.0, "2025-09-01": 0.0, "2025-09-02": 0.0, "2025-09-03": 3.0, "2025-09-04": 122.0, "2025-09-05": 0.0, "2025-09-06": 0.0, "2025-09-07": 0.0, "2025-09-08": 0.0, "2025-09-09": 0.0, "2025-09-10": 0.0, "2025-09-11": 47.0, "2025-09-12": 0.0, "2025-09-13": 0.0, "2025-09-14": 0.0, "2025-09-15": 0.0, "2025-09-16": 0.0, "2025-09-17": 107.0, "2025-09-18": 0.0, "2025-09-19": 0.0, "2025-09-20": 0.0, "2025-09-21": 96.0, "2025-09-22": 93.0, "2025-09-23": 0.0, "2025-09-24": 0.0, "2025-09-25": 0.0, "2025-09-26": 0.0, "2025-09-27": 148.0, "2025-09-28": 0.0, "2025-09-29": 0.0, "2025-09-30": 0.0, "2025-10-01": 0.0, "2025-10-02": 0.0, "2025-10-03": 0.0, "2025-10-04": 0.0, "2025-10-05": 0.0, "2025-10-06": 7.0, "2025-10-07": 0.0, "2025-10-08": 0.0, "2025-10-09": 0.0, "2025-10-10": 0.0, "2025-10-11": 0.0, "2025-10-12": 181.0, "2025-10-13": 0.0, "2025-10-14": 0.0, "2025-10-15": 0.0, "2025-10-16": 0.0, "2025-10-17": 0.0, "2025-10-18": 0.0, "2025-10-19": 103.0, "2025-10-20": 0.0, "2025-10-21": 0.0, "2025-10-22": 0.0, "2025-10-23": 0.0, "2025-10-24": 0.0, "2025-10-25": 208.0, "2025-10-26": 0.0, "2025-10-27": 0.0, "2025-10-28": 0.0, "2025-10-29": 0.0, "2025-10-30": 0.0, "2025-10-31": 0.0, "2025-11-01": 138.0, "2025-11-02": 64.0, "2025-11-03": 0.0, "2025-11-04": 0.0, "2025-11-05": 0.0, "2025-11-06": 0.0, "2025-11-07": 0.0, "2025-11-08": 110.0, "2025-11-09": 0.0, "2025-11-10": 0.0, "2025-11-11": 0.0, "2025-11-12": 0.0, "2025-11-13": 0.0, "2025-11-14": 0.0, "2025-11-15": 0.0, "2025-11-16": 203.0, "2025-11-17": 0.0, "2025-11-18": 0.0, "2025-11-19": 0.0, "2025-11-20": 0.0, "2025-11-21": 93.0, "2025-11-22": 0.0, "2025-11-23": 174.0, "2025-11-24": 0.0, "2025-11-25": 0.0, "2025-11-26": 0.0, "2025-11-27": 114.0, "2025-11-28": 0.0, "2025-11-29": 125.0, "2025-11-30": 165.0, "2025-12-01": 0.0, "2025-12-02": 0.0, "2025-12-03": 102.0, "2025-12-04": 0.0, "2025-12-05": 0.0, "2025-12-06": 0.0, "2025-12-07": 0.0, "2025-12-08": 0.0, "2025-12-09": 0.0, "2025-12-10": 0.0, "2025-12-11": 0.0, "2025-12-12": 0.0, "2025-12-13": 0.0, "2025-12-14": 0.0, "2025-12-15": 0.0, "2025-12-16": 0.0, "2025-12-17": 0.0, "2025-12-18": 0.0, "2025-12-19": 0.0, "2025-12-20": 0.0, "2025-12-21": 0.0, "2025-12-22": 0.0, "2025-12-23": 0.0, "2025-12-24": 0.0, "2025-12-25": 0.0, "2025-12-26": 0.0, "2025-12-27": 0.0, "2025-12-28": 0.0, "2025-12-29": 0.0, "2025-12-30": 0.0, "2025-12-31": 0.0}, "resting_heart_rate_by_date": {"2025-01-01": 41.0, "2025-01-02": 46.0, "2025-01-03": 41.0, "2025-01-04": 44.0, "2025-01-05": 47.0, "2025-01-06": 46.0, "2025-01-07": 44.0, "2025-01-08": 42.0, "2025-01-09": 45.0, "2025-01-10": 44.0, "2025-01-11": 44.0, "2025-01-12": 47.0, "2025-01-13": 47.0, "2025-01-14": 45.0, "2025-01-15": 48.0, "2025-01-16": 46.0, "2025-01-17": 46.0, "2025-01-18": 48.0, "2025-01-19": 43.0, "2025-01-20": 50.0, "2025-01-21": 43.0, "2025-01-22": 50.0, "2025-01-23": 48.0, "2025-01-24": 50.0, "2025-01-25": 45.0, "2025-01-26": 43.0, "2025-01-27": 45.0, "2025-01-28": 44.0, "2025-01-29": 45.0, "2025-01-30": 43.0, "2025-01-31": 48.0, "2025-02-01": 41.0, "2025-02-02": 43.0, "2025-02-03": 42.0, "2025-02-04": 43.0, "2025-02-05": 44.0, "2025-02-06": 43.0, "2025-02-07": 43.0, "2025-02-08": 42.0, "2025-02-09": 47.0, "2025-02-10": 45.0, "2025-02-11": 46.0, "2025-02-12": 48.0, "2025-02-13": 45.0, "2025-02-14": 49.0, "2025-02-15": 47.0, "2025-02-16": 42.0, "2025-02-17": 45.0, "2025-02-18": 50.0, "2025-02-19": 43.0, "2025-02-20": 44.0, "2025-02-21": 44.0, "2025-02-22": 46.0, "2025-02-23": 43.0, "2025-02-24": 41.0, "2025-02-25": 42.0, "2025-02-26": 44.0, "2025-02-27": 44.0, "2025-02-28": 43.0, "2025-03-01": 41.0, "2025-03-02": 39.0, "2025-03-03": 41.0, "2025-03-04": 40.0, "2025-03-05": 40.0, "2025-03-06": 40.0, "2025-03-07": 42.0, "2025-03-08": 43.0, "2025-03-09": 45.0, "2025-03-10": 44.0, "2025-03-11": 46.0, "2025-03-12": 45.0, "2025-03-13": 41.0, "2025-03-14": 46.0, "2025-03-15": 41.0, "2025-03-16": 40.0, "2025-03-17": 40.0, "2025-03-18": 41.0, "2025-03-19": 41.0, "2025-03-20": 41.0, "2025-03-21": 45.0, "2025-03-22": 40.0, "2025-03-23": 42.0, "2025-03-24": 43.0, "2025-03-25": 40.0, "2025-03-26": 43.0, "2025-03-27": 43.0, "2025-03-28": 42.0, "2025-03-29": 44.0, "2025-03-30": 42.0, "2025-03-31": 42.0, "2025-04-01": 39.0, "2025-04-02": 44.0, "2025-04-03": 42.0, "2025-04-04": 45.0, "2025-04-05": 41.0, "2025-04-06": 40.0, "2025-04-07": 44.0, "2025-04-08": 38.0, "2025-04-09": 43.0, "2025-04-10": 40.0, "2025-04-11": 42.0, "2025-04-12": 45.0, "2025-04-13": 44.0, "2025-04-14": 43.0, "2025-04-15": 40.0, "2025-04-16": 42.0, "2025-04-17": 43.0, "2025-04-18": 45.0, "2025-04-19": 44.0, "2025-04-20": 45.0, "2025-04-21": 42.0, "2025-04-22": 39.0, "2025-04-23": 43.0, "2025-04-24": 43.0, "2025-04-25": 43.0, "2025-04-26": 41.0, "2025-04-27": 42.0, "2025-04-28": 40.0, "2025-04-29": 39.0, "2025-04-30": 41.0, "2025-05-01": 43.0, "2025-05-02": 42.0, "2025-05-03": 44.0, "2025-05-04": 42.0, "2025-05-05": 44.0, "2025-05-06": 43.0, "2025-05-07": 43.0, "2025-05-08": 46.0, "2025-05-09": 44.0, "2025-05-10": 46.0, "2025-05-11": 45.0, "2025-05-12": 47.0, "2025-05-13": 43.0, "2025-05-14": 40.0, "2025-05-15": 45.0, "2025-05-16": 44.0, "2025-05-17": 46.0, "2025-05-18": 44.0, "2025-05-19": 42.0, "2025-05-20": 39.0, "2025-05-21": 40.0, "2025-05-22": 44.0, "2025-05-23": 42.0, "2025-05-24": 41.0, "2025-05-25": 40.0, "2025-05-26": 40.0, "2025-05-27": 39.0, "2025-05-28": 45.0, "2025-05-29": 44.0, "2025-05-30": 43.0, "2025-05-31": 45.0, "2025-06-01": 43.0, "2025-06-02": 42.0, "2025-06-03": 41.0, "2025-06-04": 42.0, "2025-06-05": 41.0, "2025-06-06": 44.0, "2025-06-07": 45.0, "2025-06-08": 45.0, "2025-06-09": 43.0, "2025-06-10": 44.0, "2025-06-11": 39.0, "2025-06-12": 40.0, "2025-06-13": 47.0, "2025-06-14": 45.0, "2025-06-15": 46.0, "2025-06-16": 44.0, "2025-06-17": 43.0, "2025-06-18": 44.0, "2025-06-19": 44.0, "2025-06-20": 45.0, "2025-06-21": 48.0, "2025-06-22": 46.0, "2025-06-23": 44.0, "2025-06-24": 44.0, "2025-06-25": 44.0, "2025-06-26": 44.0, "2025-06-27": 45.0, "2025-06-28": 43.0, "2025-06-29": 48.0, "2025-06-30": 46.0, "2025-07-01": 41.0, "2025-07-02": 43.0, "2025-07-03": 45.0, "2025-07-04": 44.0, "2025-07-05": 45.0, "2025-07-06": 47.0, "2025-07-07": 44.0, "2025-07-08": 38.0, "2025-07-09": 40.0, "2025-07-10": 40.0, "2025-07-11": 41.0, "2025-07-12": 40.0, "2025-07-13": 40.0, "2025-07-14": 41.0, "2025-07-15": 43.0, "2025-07-16": 40.0, "2025-07-17": 44.0, "2025-07-18": 47.0, "2025-07-19": 45.0, "2025-07-20": 47.0, "2025-07-21": 41.0, "2025-07-22": 43.0, "2025-07-23": 38.0, "2025-07-24": 40.0, "2025-07-25": 43.0, "2025-07-26": 46.0, "2025-07-27": 43.0, "2025-07-28": 44.0, "2025-07-29": 44.0, "2025-07-30": 45.0, "2025-07-31": 42.0, "2025-08-01": 43.0, "2025-08-02": 45.0, "2025-08-03": 44.0, "2025-08-04": 45.0, "2025-08-05": 46.0, "2025-08-06": 42.0, "2025-08-07": 43.0, "2025-08-08": 43.0, "2025-08-09": 46.0, "2025-08-10": 41.0, "2025-08-11": 45.0, "2025-08-12": 40.0, "2025-08-13": 44.0, "2025-08-14": 42.0, "2025-08-15": 45.0, "2025-08-16": 43.0, "2025-08-17": 42.0, "2025-08-18": 46.0, "2025-08-19": 45.0, "2025-08-20": 44.0, "2025-08-21": 43.0, "2025-08-22": 45.0, "2025-08-23": 45.0, "2025-08-24": 46.0, "2025-08-25": 49.0, "2025-08-26": 44.0, "2025-08-27": 45.0, "2025-08-28": 46.0, "2025-08-29": 47.0, "2025-08-30": 47.0, "2025-08-31": 45.0, "2025-09-01": 41.0, "2025-09-02": 40.0, "2025-09-03": 40.0, "2025-09-04": 47.0, "2025-09-05": 46.0, "2025-09-06": 44.0, "2025-09-07": 41.0, "2025-09-08": 46.0, "2025-09-09": 41.0, "2025-09-10": 40.0, "2025-09-11": 41.0, "2025-09-12": 44.0, "2025-09-13": 40.0, "2025-09-14": 44.0, "2025-09-15": 47.0, "2025-09-16": 46.0, "2025-09-17": 42.0, "2025-09-18": 45.0, "2025-09-19": 47.0, "2025-09-20": 44.0, "2025-09-21": 39.0, "2025-09-22": 45.0, "2025-09-23": 44.0, "2025-09-24": 44.0, "2025-09-25": 43.0, "2025-09-26": 41.0, "2025-09-27": 43.0, "2025-09-28": 42.0, "2025-09-29": 42.0, "2025-09-30": 46.0, "2025-10-01": 44.0, "2025-10-02": 43.0, "2025-10-03": 43.0, "2025-10-04": 46.0, "2025-10-05": 42.0, "2025-10-06": 47.0, "2025-10-07": 45.0, "2025-10-08": 46.0, "2025-10-09": 46.0, "2025-10-10": 44.0, "2025-10-11": 43.0, "2025-10-12": 42.0, "2025-10-13": 46.0, "2025-10-14": 45.0, "2025-10-15": 42.0, "2025-10-16": 44.0, "2025-10-17": 42.0, "2025-10-18": 42.0, "2025-10-19": 40.0, "2025-10-20": 44.0, "2025-10-21": 40.0, "2025-10-22": 42.0, "2025-10-23": 45.0, "2025-10-24": 41.0, "2025-10-25": 44.0, "2025-10-26": 44.0, "2025-10-27": 43.0, "2025-10-28": 44.0, "2025-10-29": 42.0, "2025-10-30": 43.0, "2025-10-31": 42.0, "2025-11-01": 46.0, "2025-11-02": 47.0, "2025-11-03": 45.0, "2025-11-04": 45.0, "2025-11-05": 46.0, "2025-11-06": 47.0, "2025-11-07": 46.0, "2025-11-08": 43.0, "2025-11-09": 47.0, "2025-11-10": 43.0, "2025-11-11": 43.0, "2025-11-12": 43.0, "2025-11-13": 42.0, "2025-11-14": 42.0, "2025-11-15": 40.0, "2025-11-16": 42.0, "2025-11-17": 47.0, "2025-11-18": 46.0, "2025-11-19": 45.0, "2025-11-20": 42.0, "2025-11-21": 44.0, "2025-11-22": 43.0, "2025-11-23": 41.0, "2025-11-24": 45.0, "2025-11-25": 46.0, "2025-11-26": 44.0, "2025-11-27": 44.0, "2025-11-28": 43.0, "2025-11-29": 44.0, "2025-11-30": 42.0, "2025-12-01": 44.0, "2025-12-02": 41.0, "2025-12-03": 43.0, "2025-12-04": 41.0, "2025-12-05": 46.0, "2025-12-06": 43.0, "2025-12-07": 41.0, "2025-12-08": 43.0, "2025-12-09": 43.0, "2025-12-10": 43.0, "2025-12-11": 42.0, "2025-12-12": 39.0, "2025-12-13": 41.0, "2025-12-14": 37.0, "2025-12-15": 38.0, "2025-12-16": 40.0, "2025-12-17": 37.0, "2025-12-18": 40.0, "2025-12-19": 41.0, "2025-12-20": 43.0, "2025-12-21": 46.0, "2025-12-22": 42.0, "2025-12-23": 44.0, "2025-12-24": 41.0, "2025-12-25": 40.0, "2025-12-26": 40.0, "2025-12-27": 41.0, "2025-12-31": 50.0}, "weight_kg_by_date": {"2025-01-01": 74.1, "2025-01-12": 73.1, "2025-02-15": 73.2, "2025-03-08": 75.0, "2025-03-25": 73.7, "2025-04-26": 76.4, "2025-06-20": 74.0, "2025-06-29": 74.0, "2025-07-01": 74.0, "2025-07-05": 75.1, "2025-07-06": 74.4, "2025-07-09": 75.1, "2025-07-17": 74.0, "2025-07-19": 74.8, "2025-07-26": 73.6, "2025-07-31": 74.3, "2025-08-01": 74.9, "2025-08-04": 74.2, "2025-08-16": 74.6, "2025-08-19": 76.5, "2025-08-20": 75.0}, "body_age_by_date": {}}, "weekly_intensity_minutes": {"labels": ["W01", "W02", "W03", "W04", "W05", "W06", "W07", "W08", "W09", "W10", "W11", "W12", "W13", "W14", "W15", "W16", "W17", "W18", "W19", "W20", "W21", "W22", "W23", "W24", "W25", "W26", "W27", "W28", "W29", "W30", "W31", "W32", "W33", "W34", "W35", "W36", "W37", "W38", "W39", "W40", "W41", "W42", "W43", "W44", "W45", "W46", "W47", "W48", "W49", "W50", "W51", "W52", "W53"], "actual_minutes": [230.0, 0.0, 0.0, 0.0, 8.0, 223.0, 81.0, 19.0, 160.0, 0.0, 70.0, 42.0, 369.0, 292.0, 71.0, 281.0, 126.0, 19.0, 0.0, 149.0, 142.0, 163.0, 175.0, 48.0, 281.0, 356.0, 217.0, 0.0, 104.0, 317.0, 214.0, 182.0, 389.0, 178.0, 63.0, 125.0, 47.0, 203.0, 241.0, 0.0, 188.0, 103.0, 208.0, 202.0, 110.0, 203.0, 267.0, 404.0, 102.0, 0.0, 0.0, 0.0, 0.0], "goal_minutes": 200.0}, "previous_monthly_trends": {"distance_km": [176.389, 82.485, 239.28, 240.747, 145.082, 171.578, 66.487, 15.517, 19.435, 27.419, 20.549, 17.155], "activity_count": [67.0, 34.0, 66.0, 59.0, 45.0, 70.0, 34.0, 24.0, 47.0, 27.0, 34.0, 16.0]}, "tables": {"running_top": [{"date": "2025-04-20", "activity_name": "浦东新区 跑步", "distance_km": 21.57, "duration_h": 1.99}, {"date": "2025-01-01", "activity_name": "嘉定区 跑步", "distance_km": 21.5, "duration_h": 1.98}, {"date": "2025-04-29", "activity_name": "跑步机", "distance_km": 7.19, "duration_h": 0.77}, {"date": "2025-04-12", "activity_name": "浦东新区 跑步", "distance_km": 5.49, "duration_h": 0.73}, {"date": "2025-04-13", "activity_name": "浦东新区 跑步", "distance_km": 5.25, "duration_h": 0.65}], "swimming_top": [{"date": "2025-02-04", "activity_name": "泳池游泳", "distance_km": 1.75, "duration_h": 1.48}, {"date": "2025-02-26", "activity_name": "泳池游泳", "distance_km": 2.02, "duration_h": 1.17}, {"date": "2025-04-28", "activity_name": "泳池游泳", "distance_km": 1.7, "duration_h": 1.03}, {"date": "2025-04-15", "activity_name": "泳池游泳", "distance_km": 1.6, "duration_h": 1.02}, {"date": "2025-02-19", "activity_name": "泳池游泳", "distance_km": 1.52, "duration_h": 0.93}], "top_activities": [{"date": "2025-08-04", "activity_name": "羽毛球", "distance_km": 0.54, "duration_h": 2.78, "type_key": "badminton"}, {"date": "2025-11-23", "activity_name": "羽毛球", "distance_km": 0.48, "duration_h": 2.66, "type_key": "badminton"}, {"date": "2025-06-23", "activity_name": "羽毛球", "distance_km": 0.69, "duration_h": 2.51, "type_key": "badminton"}, {"date": "2025-06-08", "activity_name": "羽毛球", "distance_km": 0.44, "duration_h": 2.43, "type_key": "badminton"}, {"date": "2025-06-28", "activity_name": "羽毛球", "distance_km": 0.6, "duration_h": 2.42, "type_key": "badminton"}, {"date": "2025-06-15", "activity_name": "羽毛球", "distance_km": 0.62, "duration_h": 2.34, "type_key": "badminton"}, {"date": "2025-11-29", "activity_name": "羽毛球", "distance_km": 0.64, "duration_h": 2.33, "type_key": "badminton"}, {"date": "2025-04-04", "activity_name": "羽毛球", "distance_km": 0.71, "duration_h": 2.29, "type_key": "badminton"}, {"date": "2025-02-06", "activity_name": "羽毛球", "distance_km": 0.39, "duration_h": 2.21, "type_key": "badminton"}, {"date": "2025-02-03", "activity_name": "羽毛球", "distance_km": 0.42, "duration_h": 2.2, "type_key": "badminton"}]}, "comparison_rows": [{"section": "年度概览", "key": "total_activities", "label": "活动总数", "unit": "次", "current": 147.0, "previous": 523.0, "delta": -376.0, "pct_change": -71.893}, {"section": "年度概览", "key": "active_days", "label": "活跃天数", "unit": "天", "current": 115.0, "previous": 255.0, "delta": -140.0, "pct_change": -54.902}, {"section": "年度概览", "key": "total_distance_m", "label": "总距离", "unit": "m", "current": 134786.621, "previous": 1222122.572, "delta": -1087335.951, "pct_change": -88.971}, {"section": "年度概览", "key": "total_duration_s", "label": "总时长", "unit": "s", "current": 624795.511, "previous": 1542488.874, "delta": -917693.363, "pct_change": -59.494}, {"section": "年度概览", "key": "total_calories", "label": "总卡路里", "unit": "kcal", "current": 90885.0, "previous": 216744.0, "delta": -125859.0, "pct_change": -58.068}, {"section": "年度概览", "key": "total_elevation_gain_m", "label": "总爬升", "unit": "m", "current": 193.0, "previous": 2409.0, "delta": -2216.0, "pct_change": -91.988}, {"section": "健康指标", "key": "total_steps", "label": "总步数", "unit": "步", "current": 2509196.0, "previous": 2970297.0, "delta": -461101.0, "pct_change": -15.524}, {"section": "健康指标", "key": "avg_daily_steps", "label": "日均步数", "unit": "步", "current": 6874.51, "previous": 8115.566, "delta": -1241.056, "pct_change": -15.292}, {"section": "健康指标", "key": "avg_sleep_hours", "label": "平均睡眠时长", "unit": "h", "current": 7.377, "previous": 7.461, "delta": -0.084, "pct_change": -1.126}, {"section": "跑步", "key": "count", "label": "跑步次数", "unit": "次", "current": 15.0, "previous": 51.0, "delta": -36.0, "pct_change": -70.588}, {"section": "跑步", "key": "total_distance_m", "label": "跑步距离", "unit": "m", "current": 96700.061, "previous": 307466.492, "delta": -210766.431, "pct_change": -68.549}, {"section": "跑步", "key": "avg_pace_min_per_km", "label": "跑步配速", "unit": "min/km", "current": 6.404, "previous": 7.298, "delta": -0.894, "pct_change": -12.25}, {"section": "游泳", "key": "count", "label": "游泳次数", "unit": "次", "current": 9.0, "previous": 27.0, "delta": -18.0, "pct_change": -66.667}, {"section": "游泳", "key": "total_distance_m", "label": "游泳距离", "unit": "m", "current": 12475.0, "previous": 43042.44, "delta": -30567.44, "pct_change": -71.017}, {"section": "游泳", "key": "avg_pace_min_per_100m", "label": "游泳配速", "unit": "min/100m", "current": 3.835, "previous": 4.852, "delta": -1.017, "pct_change": -20.96}, {"section": "力量训练", "key": "count", "label": "力量训练次数", "unit": "次", "current": 45.0, "previous": 78.0, "delta": -33.0, "pct_change": -42.308}, {"section": "力量训练", "key": "total_duration_s", "label": "力量训练时长", "unit": "s", "current": 126354.282, "previous": 220966.479, "delta": -94612.197, "pct_change": -42.817}, {"section": "力量训练", "key": "total_calories", "label": "力量训练卡路里", "unit": "kcal", "current": 10775.0, "previous": 19935.0, "delta": -9160.0, "pct_change": -45.949}, {"section": "力量训练", "key": "total_sets", "label": "力量训练总组数", "unit": "组", "current": 958.0, "previous": 1576.0, "delta": -618.0, "pct_change": -39.213}, {"section": "力量训练", "key": "total_reps", "label": "力量训练总次数", "unit": "次", "current": 12353.0, "previous": 19632.0, "delta": -7279.0, "pct_change": -37.077}, {"section": "羽毛球", "key": "count", "label": "羽毛球次数", "unit": "次", "current": 65.0, "previous": 119.0, "delta": -54.0, "pct_change": -45.378}, {"section": "羽毛球", "key": "total_duration_s", "label": "羽毛球时长", "unit": "s", "current": 389120.234, "previous": 769849.849, "delta": -380729.615, "pct_change": -49.455}, {"section": "羽毛球", "key": "total_distance_m", "label": "羽毛球距离", "unit": "m", "current": 25542.27, "previous": 41679.12, "delta": -16136.85, "pct_change": -38.717}, {"section": "羽毛球", "key": "total_calories", "label": "羽毛球卡路里", "unit": "kcal", "current": 67182.0, "previous": 127164.0, "delta": -59982.0, "pct_change": -47.169}]};
  </script>
  <script>
(function initReport() {
      const report = window.REPORT_DATA || {};
      const chartRefs = [];
      const customResizers = {};
      const toastEl = document.getElementById('share-toast');
      let toastTimer = null;
      let resizeRaf = 0;

      function getChartTheme() {
        return {
          textStyle: { color: '#dbe7ff' },
          grid: { left: 48, right: 30, top: 40, bottom: 40 },
          tooltip: {
            trigger: 'axis',
            backgroundColor: 'rgba(7, 16, 38, 0.95)',
            borderColor: 'rgba(100, 153, 255, 0.3)',
            textStyle: { color: '#f4f8ff' }
          },
          legend: { textStyle: { color: '#bdd2ff' } },
          xAxis: {
            axisLabel: { color: '#90a8db' },
            axisLine: { lineStyle: { color: 'rgba(116, 153, 224, 0.4)' } },
            axisTick: { show: false },
          },
          yAxis: {
            axisLabel: { color: '#90a8db' },
            splitLine: { lineStyle: { color: 'rgba(116, 153, 224, 0.16)' } },
            axisLine: { show: false },
          }
        };
      }

      function fmtNumber(v, digits) {
        const n = Number(v || 0);
        return n.toLocaleString(undefined, {
          minimumFractionDigits: digits,
          maximumFractionDigits: digits
        });
      }

      function fmtPct(v) {
        const n = Number(v || 0);
        return (n >= 0 ? '+' : '') + n.toFixed(2) + '%';
      }

      function setText(id, value) {
        const el = document.getElementById(id);
        if (el) el.textContent = value;
      }

      function setHtml(id, value) {
        const el = document.getElementById(id);
        if (el) el.innerHTML = value;
      }

      function showToast(message, type) {
        if (!toastEl) return;
        toastEl.textContent = message || '';
        toastEl.className = `share-toast show ${type || ''}`.trim();
        if (toastTimer) {
          clearTimeout(toastTimer);
        }
        toastTimer = setTimeout(() => {
          toastEl.className = 'share-toast';
        }, 2200);
      }

      function metricCard(label, value, hint) {
        return `
          <div class="metric-card">
            <div class="metric-label">${label}</div>
            <div class="metric-value">${value}</div>
            ${hint ? `<div class="metric-hint">${hint}</div>` : ''}
          </div>
        `;
      }

      function compactLabel(label) {
        if (!label) return '';
        return label.length > 4 ? label.slice(0, 4) + '…' : label;
      }

      function renderTopCards(rows, includeType) {
        return `
          <div class="activity-cards">
            ${rows.map((row) => `
              <article class="activity-card">
                <div class="activity-line">
                  <div class="activity-name">${row.activity_name || '-'}</div>
                  <div class="activity-date">${row.date || ''}</div>
                </div>
                <div class="activity-meta">
                  ${includeType ? `<span class="activity-pill">${row.type_key || '-'}</span>` : ''}
                  <span class="activity-pill">${fmtNumber(row.distance_km || 0, 2)} km</span>
                  <span class="activity-pill">${fmtNumber(row.duration_h || 0, 2)} h</span>
                </div>
              </article>
            `).join('')}
          </div>
        `;
      }

      function renderTopTable(rows, includeType) {
        if (!Array.isArray(rows) || rows.length === 0) {
          return '<p class="muted-note">暂无数据</p>';
        }
        if (isMobile) {
          return renderTopCards(rows, includeType);
        }
        const typeHead = includeType ? '<th>类型</th>' : '';
        const body = rows.map((row) => `
          <tr>
            <td>${row.date || ''}</td>
            ${includeType ? `<td>${row.type_key || ''}</td>` : ''}
            <td>${row.activity_name || ''}</td>
            <td>${fmtNumber(row.distance_km || 0, 2)} km</td>
            <td>${fmtNumber(row.duration_h || 0, 2)} h</td>
          </tr>
        `).join('');
        return `
          <table>
            <thead>
              <tr>
                <th>日期</th>
                ${typeHead}
                <th>名称</th>
                <th>距离</th>
                <th>时长</th>
              </tr>
            </thead>
            <tbody>${body}</tbody>
          </table>
        `;
      }

      function toIsoDateKey(dt) {
        const y = dt.getFullYear();
        const m = String(dt.getMonth() + 1).padStart(2, '0');
        const d = String(dt.getDate()).padStart(2, '0');
        return `${y}-${m}-${d}`;
      }

      function clamp(value, min, max) {
        return Math.max(min, Math.min(max, value));
      }

      function normalizeIsoAxisSize(value) {
        let size = Math.max(6, Math.round(Number(value) || 0));
        if (size % 2 !== 0) {
          size -= 1;
        }
        if (size < 6) {
          size = 6;
        }
        return size;
      }

      function normalizeIsoCubeHeight(value) {
        return Math.max(3, Math.round(Number(value) || 0));
      }

      function valueToLevel(value, maxVal) {
        if (!maxVal || value <= 0) return 0;
        const ratio = value / maxVal;
        if (ratio <= 0.2) return 1;
        if (ratio <= 0.45) return 2;
        if (ratio <= 0.7) return 3;
        return 4;
      }

      function hexToRgba(hex, alpha) {
        const safe = String(hex || '').replace('#', '').padStart(6, '0').slice(0, 6);
        const r = Number.parseInt(safe.slice(0, 2), 16) || 0;
        const g = Number.parseInt(safe.slice(2, 4), 16) || 0;
        const b = Number.parseInt(safe.slice(4, 6), 16) || 0;
        return `rgba(${r}, ${g}, ${b}, ${clamp(Number(alpha || 1), 0, 1)})`;
      }

      function buildIsoMonthMarkers(weeks) {
        const markers = [];
        let lastMonth = -1;
        weeks.forEach((week, weekIdx) => {
          const firstDay = week.find((d) => d.date && d.date.slice(8, 10) === '01');
          if (!firstDay) return;
          const dt = new Date(`${firstDay.date}T00:00:00`);
          const month = dt.getMonth();
          if (month === lastMonth) return;
          lastMonth = month;
          markers.push({ weekIdx, label: `${month + 1}月` });
        });
        if (!markers.length) {
          markers.push({ weekIdx: 0, label: '1月' });
        }
        return markers;
      }

      function renderFlatContributionGrid(target, contribution, options) {
        if (!target) return;
        target.innerHTML = '';
        const weeks = Array.isArray(contribution.weeks) ? contribution.weeks : [];
        const weekCount = Math.max(weeks.length, 1);
        const palette = Array.isArray(options.palette) && options.palette.length >= 5
          ? options.palette
          : ['161b22', '0e4429', '006d32', '26a641', '39d353'];
        const unitLabel = options.unitLabel || '';
        const root = document.createElement('div');
        root.className = 'iso-flat-root';

        const months = document.createElement('div');
        months.className = 'iso-flat-months';
        buildIsoMonthMarkers(weeks).forEach((item) => {
          const marker = document.createElement('span');
          marker.className = 'iso-flat-month';
          const leftPct = weekCount <= 1 ? 0 : (item.weekIdx / (weekCount - 1)) * 100;
          marker.style.left = `${leftPct.toFixed(2)}%`;
          marker.textContent = item.label;
          months.appendChild(marker);
        });
        root.appendChild(months);

        const main = document.createElement('div');
        main.className = 'iso-flat-main';
        const dayAxis = document.createElement('div');
        dayAxis.className = 'iso-flat-days';
        ['一', '', '三', '', '五', '', ''].forEach((label) => {
          const el = document.createElement('span');
          el.textContent = label;
          dayAxis.appendChild(el);
        });
        main.appendChild(dayAxis);

        const grid = document.createElement('div');
        grid.className = 'iso-flat-grid';
        grid.style.setProperty('--week-count', String(weekCount));
        weeks.forEach((week, weekIdx) => {
          week.forEach((day, dayIdx) => {
            const cell = document.createElement('div');
            const value = Number(day.value || 0);
            const level = valueToLevel(value, contribution.maxVal);
            const colorHex = palette[level] || palette[0];
            cell.className = 'iso-flat-cell';
            cell.style.gridColumn = String(weekIdx + 1);
            cell.style.gridRow = String(dayIdx + 1);
            if (!day.date) {
              cell.classList.add('empty');
              cell.title = '';
            } else {
              const bg = level === 0
                ? 'rgba(17, 29, 54, 0.86)'
                : hexToRgba(colorHex, 0.92);
              cell.style.background = bg;
              cell.title = `${day.date} ${fmtNumber(value, 2)} ${unitLabel}`;
            }
            grid.appendChild(cell);
          });
        });
        main.appendChild(grid);
        root.appendChild(main);

        const legend = document.createElement('div');
        legend.className = 'iso-flat-legend';
        legend.innerHTML = '<span>Less</span>';
        for (let idx = 0; idx < 5; idx++) {
          const swatch = document.createElement('span');
          swatch.className = 'iso-flat-swatch';
          swatch.style.background = idx === 0
            ? 'rgba(17, 29, 54, 0.86)'
            : hexToRgba(palette[idx], 0.92);
          legend.appendChild(swatch);
        }
        legend.insertAdjacentHTML('beforeend', '<span>More</span>');
        root.appendChild(legend);

        target.appendChild(root);
      }

      function buildIsoContributionData(dailyMap) {
        const targetYear = Number(report.year || new Date().getFullYear());
        const firstDay = new Date(targetYear, 0, 1);
        const lastDay = new Date(targetYear, 11, 31);
        const firstWeekStart = new Date(firstDay);
        firstWeekStart.setDate(firstDay.getDate() - ((firstDay.getDay() + 6) % 7));
        const msWeek = 7 * 24 * 60 * 60 * 1000;

        const byDate = {};
        Object.entries(dailyMap || {}).forEach(([dateText, val]) => {
          const key = String(dateText || '').slice(0, 10);
          const parsed = Number(val || 0);
          if (key) {
            byDate[key] = Number.isFinite(parsed) ? parsed : 0;
          }
        });

        const weeks = [];
        let maxVal = 0;
        let total = 0;
        let bestDay = '';
        let bestValue = 0;
        let dayCount = 0;

        for (let cursor = new Date(firstDay); cursor <= lastDay; cursor.setDate(cursor.getDate() + 1)) {
          const iso = toIsoDateKey(cursor);
          const weekday = (cursor.getDay() + 6) % 7;
          const weekIndex = Math.floor((cursor - firstWeekStart) / msWeek);
          while (weeks.length <= weekIndex) {
            weeks.push(Array.from({ length: 7 }, () => ({ date: '', value: 0 })));
          }
          const value = Number(byDate[iso] || 0);
          const finalValue = Number.isFinite(value) ? value : 0;
          weeks[weekIndex][weekday] = { date: iso, value: finalValue };
          total += finalValue;
          dayCount += 1;
          if (finalValue > maxVal) maxVal = finalValue;
          if (finalValue > bestValue) {
            bestValue = finalValue;
            bestDay = iso;
          }
        }

        let bestWeekTotal = 0;
        weeks.forEach((week) => {
          const weekValue = week.reduce((sum, item) => sum + Number(item.value || 0), 0);
          if (weekValue > bestWeekTotal) {
            bestWeekTotal = weekValue;
          }
        });

        return {
          weeks,
          maxVal,
          total,
          average: dayCount ? total / dayCount : 0,
          bestDay,
          bestValue,
          bestWeekTotal,
        };
      }

      function buildSortedDailySeries(dailyMap) {
        const rows = Object.entries(dailyMap || {})
          .map(([dateText, value]) => {
            const key = String(dateText || '').slice(0, 10);
            if (!key) return null;
            const parsed = Number(value || 0);
            return {
              date: key,
              value: Number.isFinite(parsed) ? parsed : 0,
            };
          })
          .filter(Boolean)
          .sort((a, b) => a.date.localeCompare(b.date));
        return {
          dates: rows.map((item) => item.date),
          values: rows.map((item) => item.value),
        };
      }

      function computeSeriesRange(values, options) {
        const cfg = options || {};
        const pad = Number(cfg.pad || 0);
        const minSpan = Number(cfg.minSpan || 0);
        const precision = Number.isFinite(cfg.precision) ? Math.max(0, cfg.precision) : 2;
        const minClamp = Number.isFinite(cfg.minClamp) ? Number(cfg.minClamp) : null;
        const maxClamp = Number.isFinite(cfg.maxClamp) ? Number(cfg.maxClamp) : null;
        const numericValues = (values || [])
          .map((v) => Number(v))
          .filter((v) => Number.isFinite(v));
        if (!numericValues.length) {
          return null;
        }
        const rawMin = Math.min(...numericValues);
        const rawMax = Math.max(...numericValues);
        const span = Math.max(rawMax - rawMin, minSpan);
        let min = rawMin - pad;
        let max = rawMax + pad;
        if ((max - min) < span) {
          const center = (rawMin + rawMax) / 2;
          min = center - span / 2;
          max = center + span / 2;
        }
        if (minClamp !== null) min = Math.max(min, minClamp);
        if (maxClamp !== null) max = Math.min(max, maxClamp);
        if (max <= min) {
          max = min + Math.max(minSpan, 1);
        }
        const factor = 10 ** precision;
        return {
          min: Math.floor(min * factor) / factor,
          max: Math.ceil(max * factor) / factor,
        };
      }

      function chartOrNote(id) {
        const el = document.getElementById(id);
        if (!el) return null;
        if (!window.echarts) {
          el.innerHTML = '<p class="muted-note">ECharts 未加载，无法渲染图表</p>';
          return null;
        }
        const chart = window.echarts.init(el);
        chartRefs.push(chart);
        return chart;
      }

      const overview = report.activity_overview || {};
      const health = report.health_overview || {};
      const running = ((report.sports || {}).running) || {};
      const swimming = ((report.sports || {}).swimming) || {};
      const typeAnalysis = ((report.sports || {}).type_analysis) || {};
      const monthly = report.monthly_trends || {};
      const dailyTrends = report.daily_trends || {};
      const monthlyPrev = report.previous_monthly_trends || {};
      const compareRows = Array.isArray(report.comparison_rows) ? report.comparison_rows : [];
      const exportBtn = document.getElementById('btn-export-pdf');
      const reportShell = document.querySelector('.report-shell');
      const compareDetails = document.getElementById('compare-details');
      const isMobile = window.matchMedia('(max-width: 760px)').matches;
      const exportBtnDefaultText = exportBtn ? (exportBtn.textContent || '分享 / 打印 PDF') : '分享 / 打印 PDF';
      let printInProgress = false;
      const dailyCaloriesByDate = dailyTrends.calories_by_date || {};
      const dailyDurationByDate = dailyTrends.duration_h_by_date || {};
      const dailyIntensityByDate = dailyTrends.intensity_minutes_by_date || {};
      const dailyWeightByDate = dailyTrends.weight_kg_by_date || {};
      const dailyBodyAgeByDate = dailyTrends.body_age_by_date || {};
      const dailyRestingHeartRateByDate = dailyTrends.resting_heart_rate_by_date || {};
      const weeklyIntensityMinutes = report.weekly_intensity_minutes || {};
      const ISO_VIEW_MODES = ['2d', '3d', 'both'];
      const hasBodyAgeData = Object.keys(dailyBodyAgeByDate).length > 0;

      if (!hasBodyAgeData) {
        const bodyAgeChartEl = document.getElementById('chart-health-body-age-trend');
        const bodyAgePanel = bodyAgeChartEl ? bodyAgeChartEl.closest('.panel') : null;
        if (bodyAgePanel) {
          bodyAgePanel.remove();
        }
        const weightPanel = document.getElementById('chart-health-weight-trend')?.closest('.panel');
        const rhrPanel = document.getElementById('chart-health-resting-hr-trend')?.closest('.panel');
        if (weightPanel) {
          weightPanel.style.gridColumn = 'span 6';
        }
        if (rhrPanel) {
          rhrPanel.style.gridColumn = 'span 6';
        }
      }

      function resolveInitialIsoViewMode() {
        const params = new URLSearchParams(window.location.search);
        const fromQuery = (params.get('isoView') || '').toLowerCase();
        if (ISO_VIEW_MODES.includes(fromQuery)) return fromQuery;
        try {
          const saved = (localStorage.getItem('garmin-report-iso-view') || '').toLowerCase();
          if (ISO_VIEW_MODES.includes(saved)) return saved;
        } catch (err) {
          console.warn('读取热力图视图设置失败', err);
        }
        return isMobile ? '3d' : 'both';
      }

      let isoViewMode = resolveInitialIsoViewMode();

      function updateIsoViewButtons() {
        document.querySelectorAll('.iso-view-btn').forEach((btn) => {
          const mode = (btn.dataset.isoMode || '').toLowerCase();
          btn.classList.toggle('active', mode === isoViewMode);
        });
      }

      function updateIsoViewContainers() {
        ['chart-sports-daily-calories-3d', 'chart-sports-daily-duration-3d'].forEach((id) => {
          const el = document.getElementById(id);
          if (el) {
            el.setAttribute('data-iso-view-mode', isoViewMode);
            const stage = el.querySelector('.iso-stage');
            if (stage) {
              stage.setAttribute('data-iso-view-mode', isoViewMode);
            }
          }
        });
      }

      function setIsoViewMode(nextMode, persist) {
        const mode = String(nextMode || '').toLowerCase();
        if (!ISO_VIEW_MODES.includes(mode)) return;
        isoViewMode = mode;
        updateIsoViewButtons();
        updateIsoViewContainers();
        if (persist) {
          try {
            localStorage.setItem('garmin-report-iso-view', isoViewMode);
          } catch (err) {
            console.warn('保存热力图视图设置失败', err);
          }
        }
        if (typeof customResizers.sportsDailyCalories3D === 'function') {
          customResizers.sportsDailyCalories3D();
        }
        if (typeof customResizers.sportsDailyDuration3D === 'function') {
          customResizers.sportsDailyDuration3D();
        }
      }

      document.querySelectorAll('.iso-view-btn').forEach((btn) => {
        btn.addEventListener('click', function () {
          setIsoViewMode(btn.dataset.isoMode, true);
        });
      });
      updateIsoViewButtons();
      updateIsoViewContainers();

      if (compareDetails && isMobile) {
        compareDetails.open = false;
      }

      async function shareReportLink() {
        const shareTitle = `Garmin ${report.year || ''} 年度报告`;
        try {
          if (navigator.share) {
            await navigator.share({
              title: shareTitle,
              text: '我的 Garmin 年度运动报告',
              url: window.location.href,
            });
            showToast('已打开系统分享面板', 'success');
            return true;
          }
          if (navigator.clipboard && navigator.clipboard.writeText) {
            await navigator.clipboard.writeText(window.location.href);
            showToast('报告链接已复制到剪贴板', 'success');
            return true;
          }
        } catch (err) {
          console.error('分享失败', err);
          showToast('分享失败，请重试', 'error');
          return false;
        }
        showToast('当前浏览器不支持分享', 'error');
        return false;
      }

      setText('hero-total-activities', fmtNumber(overview.total_activities || 0, 0) + ' 次');
      setText('hero-total-distance', fmtNumber((overview.total_distance_m || 0) / 1000, 1) + ' km');
      setText('hero-total-duration', fmtNumber((overview.total_duration_s || 0) / 3600, 1) + ' h');

      setHtml('overview-kpis', [
        metricCard('活动总数', fmtNumber(overview.total_activities || 0, 0), '全年总活动次数'),
        metricCard('活跃天数', fmtNumber(overview.active_days || 0, 0), '有运动记录的天数'),
        metricCard('总距离', fmtNumber((overview.total_distance_m || 0) / 1000, 1) + ' km', ''),
        metricCard('总时长', fmtNumber((overview.total_duration_s || 0) / 3600, 1) + ' h', ''),
        metricCard('总卡路里', fmtNumber(overview.total_calories || 0, 0) + ' kcal', ''),
        metricCard('总爬升', fmtNumber(overview.total_elevation_gain_m || 0, 0) + ' m', ''),
      ].join(''));

      setHtml('sports-kpis', [
        metricCard('跑步次数', fmtNumber(running.count || 0, 0), ''),
        metricCard('跑步总距离', fmtNumber((running.total_distance_m || 0) / 1000, 1) + ' km', ''),
        metricCard('跑步平均配速', running.avg_pace_min_per_km ? fmtNumber(running.avg_pace_min_per_km, 2) + ' min/km' : 'N/A', ''),
        metricCard('游泳次数', fmtNumber(swimming.count || 0, 0), ''),
        metricCard('游泳总距离', fmtNumber((swimming.total_distance_m || 0) / 1000, 1) + ' km', ''),
        metricCard('游泳平均配速', swimming.avg_pace_min_per_100m ? fmtNumber(swimming.avg_pace_min_per_100m, 2) + ' min/100m' : 'N/A', ''),
      ].join(''));

      setHtml('health-kpis', [
        metricCard('睡眠记录', fmtNumber(health.sleep_recorded_days || 0, 0) + ' 天', ''),
        metricCard('平均睡眠时长', fmtNumber(health.avg_sleep_hours || 0, 2) + ' h', ''),
        metricCard('平均睡眠分数', fmtNumber(health.avg_sleep_score || 0, 1), ''),
        metricCard('平均深睡时长', fmtNumber(health.avg_deep_sleep_hours || 0, 2) + ' h', ''),
        metricCard('总步数', fmtNumber(health.total_steps || 0, 0) + ' 步', ''),
        metricCard('日均步数', fmtNumber(health.avg_daily_steps || 0, 0) + ' 步', ''),
        metricCard('日均强度活动', fmtNumber(health.avg_daily_intensity_minutes || 0, 1) + ' min', ''),
      ].join(''));

      setHtml('table-running', renderTopTable((report.tables || {}).running_top, false));
      setHtml('table-swimming', renderTopTable((report.tables || {}).swimming_top, false));
      setHtml('table-top-activities', renderTopTable((report.tables || {}).top_activities, true));

      setHtml('compare-rows', compareRows.length ? compareRows.map((row) => {
        const pctClass = (row.pct_change || 0) >= 0 ? 'pos' : 'neg';
        const unit = row.unit || '';
        return `
          <div class="compare-row">
            <div class="compare-cell section">${row.section || ''}</div>
            <div class="compare-cell label">${row.label || ''}</div>
            <div class="compare-cell">
              <span class="cell-tag">上一年</span>${fmtNumber(row.previous || 0, 2)} ${unit}
            </div>
            <div class="compare-cell">
              <span class="cell-tag">本年度</span>${fmtNumber(row.current || 0, 2)} ${unit}
            </div>
            <div class="compare-cell pct ${pctClass}">
              <span class="cell-tag">同比</span>${fmtPct(row.pct_change || 0)}
            </div>
          </div>
        `;
      }).join('') : '<p class="muted-note">分析文件中没有上一年同比字段。</p>');

      const common = getChartTheme();
      const labels = monthly.labels || [];
      const typeLabels = typeAnalysis.labels || [];
      let overviewChart = null;
      let sportPie = null;
      let overviewTypeCalories = null;
      let overviewTypeDuration = null;
      let overviewTypeIntensity = null;
      let sportMatrix = null;
      let sportCalories = null;
      let sportsWeeklyIntensityGoal = null;
      let healthMonthly = null;
      let healthWeightTrend = null;
      let healthBodyAgeTrend = null;
      let healthRestingHeartRateTrend = null;
      let compareMonthly = null;

      function ensureOverviewChart() {
        if (overviewChart) return overviewChart;
        overviewChart = chartOrNote('chart-overview-monthly');
        if (!overviewChart) return null;
        overviewChart.setOption({
          ...common,
          legend: { ...common.legend, data: ['月度里程(km)', '活动次数'] },
          xAxis: { ...common.xAxis, type: 'category', data: labels },
          yAxis: [
            { ...common.yAxis, type: 'value', name: 'km' },
            { ...common.yAxis, type: 'value', name: '次' },
          ],
          series: [
            {
              name: '月度里程(km)',
              type: 'bar',
              data: monthly.distance_km || [],
              itemStyle: { color: '#4ca7ff', borderRadius: [6, 6, 0, 0] },
            },
            {
              name: '活动次数',
              type: 'line',
              yAxisIndex: 1,
              smooth: true,
              data: monthly.activity_count || [],
              lineStyle: { width: 3, color: '#54f1d2' },
              itemStyle: { color: '#54f1d2' },
            },
          ],
        });
        return overviewChart;
      }

      function ensureSportPieChart() {
        if (sportPie) return sportPie;
        sportPie = chartOrNote('chart-sport-type-pie');
        if (!sportPie) return null;
        sportPie.setOption({
          backgroundColor: 'transparent',
          tooltip: {
            trigger: 'item',
            backgroundColor: 'rgba(7, 16, 38, 0.95)',
            borderColor: 'rgba(100, 153, 255, 0.3)',
            textStyle: { color: '#f4f8ff' }
          },
          series: [
            {
              type: 'pie',
              radius: ['34%', '72%'],
              roseType: 'radius',
              itemStyle: { borderColor: '#0e1a36', borderWidth: 2 },
              label: { color: '#d7e6ff' },
              data: typeLabels.map((label, idx) => ({
                name: label,
                value: (typeAnalysis.by_count || [])[idx] || 0,
              })),
            },
          ],
        });
        return sportPie;
      }

      function setTypeDonutOption(chart, metricName, values, unitLabel) {
        chart.setOption({
          backgroundColor: 'transparent',
          tooltip: {
            trigger: 'item',
            backgroundColor: 'rgba(7, 16, 38, 0.95)',
            borderColor: 'rgba(100, 153, 255, 0.3)',
            textStyle: { color: '#f4f8ff' },
            formatter: function (params) {
              const val = Number(params.value || 0);
              return `${params.name}<br/>${metricName}: ${fmtNumber(val, 2)} ${unitLabel}`;
            },
          },
          legend: {
            show: false,
          },
          series: [
            {
              name: metricName,
              type: 'pie',
              radius: ['42%', '72%'],
              center: ['50%', '54%'],
              avoidLabelOverlap: true,
              minAngle: 4,
              label: {
                color: '#d7e6ff',
                formatter: function (params) {
                  return `${compactLabel(params.name)}\\n${params.percent.toFixed(0)}%`;
                },
                fontSize: isMobile ? 10 : 11,
              },
              itemStyle: { borderColor: '#0e1a36', borderWidth: 2 },
              data: typeLabels.map((label, idx) => ({
                name: label,
                value: (values || [])[idx] || 0,
              })),
            },
          ],
        });
      }

      function ensureOverviewTypeDistributionCharts() {
        if (!overviewTypeCalories) {
          overviewTypeCalories = chartOrNote('chart-overview-type-calories');
          if (overviewTypeCalories) {
            setTypeDonutOption(overviewTypeCalories, '卡路里', typeAnalysis.by_calories || [], 'kcal');
          }
        }
        if (!overviewTypeDuration) {
          overviewTypeDuration = chartOrNote('chart-overview-type-duration');
          if (overviewTypeDuration) {
            setTypeDonutOption(overviewTypeDuration, '时长', typeAnalysis.by_duration_h || [], 'h');
          }
        }
        if (!overviewTypeIntensity) {
          overviewTypeIntensity = chartOrNote('chart-overview-type-intensity');
          if (overviewTypeIntensity) {
            setTypeDonutOption(overviewTypeIntensity, '强度时间', typeAnalysis.by_intensity_minutes || [], 'min');
          }
        }
        if (overviewTypeCalories) overviewTypeCalories.resize();
        if (overviewTypeDuration) overviewTypeDuration.resize();
        if (overviewTypeIntensity) overviewTypeIntensity.resize();
      }

      function ensureSportMatrixChart() {
        if (sportMatrix) return sportMatrix;
        sportMatrix = chartOrNote('chart-sport-matrix');
        if (!sportMatrix) return null;
        sportMatrix.setOption({
          ...common,
          grid: isMobile ? { ...common.grid, left: 36, right: 14, bottom: 58 } : common.grid,
          legend: { ...common.legend, data: ['次数', '时长(h)', '距离(km)'] },
          xAxis: {
            ...common.xAxis,
            type: 'category',
            data: typeLabels,
            axisLabel: {
              color: '#90a8db',
              rotate: isMobile ? 24 : 0,
              interval: 0,
            },
          },
          yAxis: { ...common.yAxis, type: 'value' },
          series: [
            {
              name: '次数',
              type: 'bar',
              data: typeAnalysis.by_count || [],
              itemStyle: { color: '#5fa7ff' },
            },
            {
              name: '时长(h)',
              type: 'bar',
              data: typeAnalysis.by_duration_h || [],
              itemStyle: { color: '#4ce1d4' },
            },
            {
              name: '距离(km)',
              type: 'line',
              smooth: true,
              data: typeAnalysis.by_distance_km || [],
              lineStyle: { width: 2.8, color: '#ff9f70' },
              itemStyle: { color: '#ff9f70' },
            },
          ],
        });
        return sportMatrix;
      }

      function ensureSportCaloriesChart() {
        if (sportCalories) return sportCalories;
        sportCalories = chartOrNote('chart-sport-calories');
        if (!sportCalories) return null;
        sportCalories.setOption({
          ...common,
          grid: isMobile ? { ...common.grid, left: 36, right: 14, bottom: 66 } : common.grid,
          xAxis: {
            ...common.xAxis,
            type: 'category',
            data: typeLabels,
            axisLabel: {
              rotate: isMobile ? 35 : 20,
              color: '#90a8db',
              interval: 0,
              formatter: compactLabel,
            },
          },
          yAxis: { ...common.yAxis, type: 'value', name: 'kcal' },
          series: [
            {
              name: '卡路里',
              type: 'bar',
              data: typeAnalysis.by_calories || [],
              itemStyle: { color: '#ff7a9e', borderRadius: [6, 6, 0, 0] },
            }
          ],
        });
        return sportCalories;
      }

      function ensureSportsWeeklyIntensityGoalChart() {
        if (sportsWeeklyIntensityGoal) return sportsWeeklyIntensityGoal;
        sportsWeeklyIntensityGoal = chartOrNote('chart-sports-weekly-intensity-goal');
        if (!sportsWeeklyIntensityGoal) return null;
        const labelsData = Array.isArray(weeklyIntensityMinutes.labels) ? weeklyIntensityMinutes.labels : [];
        const actualData = Array.isArray(weeklyIntensityMinutes.actual_minutes) ? weeklyIntensityMinutes.actual_minutes : [];
        const goal = Number(weeklyIntensityMinutes.goal_minutes || 200);
        const goalData = labelsData.map(() => goal);
        sportsWeeklyIntensityGoal.setOption({
          ...common,
          grid: isMobile ? { ...common.grid, left: 32, right: 14, bottom: 68 } : { ...common.grid, left: 46, right: 20, bottom: 56 },
          legend: { ...common.legend, data: ['目标值', '实际强度分钟'] },
          xAxis: {
            ...common.xAxis,
            type: 'category',
            data: labelsData,
            axisLabel: {
              color: '#90a8db',
              interval: isMobile ? 3 : 1,
              rotate: isMobile ? 35 : 0,
            },
          },
          yAxis: { ...common.yAxis, type: 'value', name: 'min' },
          series: [
            {
              name: '目标值',
              type: 'bar',
              data: goalData,
              barWidth: isMobile ? 9 : 12,
              barGap: '-100%',
              itemStyle: { color: 'rgba(135, 152, 186, 0.36)', borderRadius: [4, 4, 0, 0] },
              z: 1,
            },
            {
              name: '实际强度分钟',
              type: 'bar',
              data: actualData,
              barWidth: isMobile ? 7 : 9,
              itemStyle: {
                borderRadius: [4, 4, 0, 0],
                color: function (params) {
                  const val = Number(params.value || 0);
                  return val >= goal ? '#39d98a' : '#5ea7ff';
                },
              },
              z: 2,
            },
          ],
          tooltip: {
            trigger: 'axis',
            axisPointer: { type: 'shadow' },
            backgroundColor: 'rgba(7, 16, 38, 0.95)',
            borderColor: 'rgba(100, 153, 255, 0.3)',
            textStyle: { color: '#f4f8ff' },
            formatter: function (params) {
              const actual = Number((params || []).find((item) => item.seriesName === '实际强度分钟')?.value || 0);
              const ratio = goal > 0 ? (actual / goal) * 100 : 0;
              return `${params?.[0]?.axisValue || ''}<br/>目标值: ${fmtNumber(goal, 0)} min<br/>实际: ${fmtNumber(actual, 1)} min<br/>达成率: ${fmtNumber(ratio, 1)}%`;
            },
          },
        });
        return sportsWeeklyIntensityGoal;
      }

      function renderIsometricContributionChart(containerId, dailyMap, options) {
        const container = document.getElementById(containerId);
        if (!container) return;
        container.innerHTML = '';
        if (!window.obelisk) {
          container.innerHTML = '<p class="muted-note">Obelisk.js 未加载，无法渲染等距热力图</p>';
          return;
        }
        const metricLabel = options.metricLabel || '贡献';
        const unitLabel = options.unitLabel || '';
        const weekLabel = options.weekLabel || '最佳一周';
        const dayLabel = options.dayLabel || '最佳一天';
        const valuePrecision = Number.isFinite(options.valuePrecision) ? options.valuePrecision : 0;
        const tiltDegrees = clamp(Number(options.tiltDegrees || 60), 40, 72);
        const tiltFactor = Math.tan((tiltDegrees * (Math.PI / 180))) / Math.tan(45 * (Math.PI / 180));
        const palette = Array.isArray(options.palette) && options.palette.length >= 5
          ? options.palette
          : ['161b22', '0e4429', '006d32', '26a641', '39d353'];
        const contribution = buildIsoContributionData(dailyMap);
        container.setAttribute('data-iso-view-mode', isoViewMode);

        const stats = document.createElement('div');
        stats.className = 'iso-stats';
        stats.innerHTML = `
          <div style="font-size: 10px; color: #92a8d6;">${metricLabel}</div>
          <div class="big">${fmtNumber(contribution.total || 0, valuePrecision)}</div>
          <div>平均 ${fmtNumber(contribution.average || 0, 2)} / 天</div>
          <div class="row"><span>${weekLabel}</span><span>${fmtNumber(contribution.bestWeekTotal || 0, valuePrecision)} ${unitLabel}</span></div>
          <div class="row"><span>${dayLabel}</span><span>${fmtNumber(contribution.bestValue || 0, valuePrecision)} ${unitLabel}</span></div>
        `;
        container.appendChild(stats);

        const stage = document.createElement('div');
        stage.className = 'iso-stage';
        stage.setAttribute('data-iso-view-mode', isoViewMode);
        container.appendChild(stage);

        const wrap3d = document.createElement('div');
        wrap3d.className = 'iso-3d-wrap';
        stage.appendChild(wrap3d);

        const canvas = document.createElement('canvas');
        canvas.className = 'iso-canvas';
        canvas.title = `${metricLabel} 等距热力图`;
        wrap3d.appendChild(canvas);

        const wrap2d = document.createElement('div');
        wrap2d.className = 'iso-2d-wrap';
        stage.appendChild(wrap2d);
        renderFlatContributionGrid(wrap2d, contribution, { palette, unitLabel });

        if (isoViewMode === '2d') {
          return;
        }

        const rect = wrap3d.getBoundingClientRect();
        const dpr = Math.max(1, window.devicePixelRatio || 1);
        const cssWidth = Math.max(280, Math.floor(rect.width || wrap3d.clientWidth || 560));
        const cssHeight = Math.max(180, Math.floor(rect.height || wrap3d.clientHeight || 300));
        canvas.width = Math.floor(cssWidth * dpr);
        canvas.height = Math.floor(cssHeight * dpr);
        canvas.style.width = `${cssWidth}px`;
        canvas.style.height = `${cssHeight}px`;

        const weekCount = Math.max(contribution.weeks.length, 1);
        const isBothMode = isoViewMode === 'both';
        const statsWidthCss = !isMobile ? Math.ceil(stats.getBoundingClientRect().width || 0) : 0;
        const statsReservePx = !isMobile ? Math.ceil(statsWidthCss * dpr) + Math.ceil((isBothMode ? 12 : 16) * dpr) : 0;
        const padLeft = Math.ceil(12 * dpr);
        const padTop = Math.ceil((isMobile ? 8 : 14) * dpr);
        const padBottom = Math.ceil((isMobile ? 12 : 16) * dpr);
        const padRight = Math.ceil((isBothMode ? 8 : 12) * dpr) + statsReservePx;
        const availWidth = Math.max(1, canvas.width - padLeft - padRight);
        const availHeight = Math.max(1, canvas.height - padTop - padBottom);
        const effectiveWidth = Math.max(220, canvas.width - statsReservePx - Math.ceil((isBothMode ? 24 : 20) * dpr));
        const rawStep = Math.floor((effectiveWidth * (isBothMode ? 0.9 : 0.96)) / weekCount);
        const minStep = isMobile ? 6 : 8;
        const maxStep = isMobile ? 14 : 28;
        let step = clamp(rawStep, minStep, maxStep);
        const maxCubeHeight = Math.max(
          normalizeIsoCubeHeight(Math.round(canvas.height * (isBothMode ? 0.16 : 0.2))),
          isMobile ? 20 : 38
        );

        try {
          const fallbackColor = Number.parseInt(palette[0], 16);
          function buildGeometry(stepValue) {
            const cubeSize = normalizeIsoAxisSize(Math.round(stepValue * (isMobile ? 0.9 : 0.78)));
            const baseHeight = normalizeIsoCubeHeight(Math.round(cubeSize * 0.16));
            const yStep = Math.max(2, Math.round(Math.max(2, cubeSize - 2) * tiltFactor));
            const cubes = [];
            let minGX = Infinity;
            let maxGX = -Infinity;
            let minGY = Infinity;
            let maxGY = -Infinity;
            contribution.weeks.forEach((week, weekIdx) => {
              week.forEach((day, dayIdx) => {
                const x3 = stepValue * weekIdx;
                const y3 = yStep * dayIdx;
                const value = Number(day.value || 0);
                const level = valueToLevel(value, contribution.maxVal);
                const colorHex = palette[level] || palette[0];
                const cubeHeight = normalizeIsoCubeHeight(baseHeight + (
                  contribution.maxVal > 0
                    ? Math.round(maxCubeHeight * (value / contribution.maxVal))
                    : 0
                ));
                const gx = x3 - y3;
                const gy = Math.floor((x3 + y3) / 2);
                minGX = Math.min(minGX, gx - cubeSize - 3);
                maxGX = Math.max(maxGX, gx + cubeSize + 3);
                minGY = Math.min(minGY, gy - cubeHeight - cubeSize - 3);
                maxGY = Math.max(maxGY, gy + Math.ceil(cubeSize / 2) + 3);
                cubes.push({
                  x3,
                  y3,
                  cubeHeight,
                  colorValue: Number.parseInt(colorHex, 16),
                });
              });
            });
            return {
              cubes,
              cubeSize,
              minGX,
              maxGX,
              minGY,
              maxGY,
              drawWidth: Math.max(1, maxGX - minGX),
              drawHeight: Math.max(1, maxGY - minGY),
            };
          }

          let geometry = buildGeometry(step);
          while (
            step > minStep
            && (geometry.drawWidth > availWidth || geometry.drawHeight > availHeight)
          ) {
            step -= 1;
            geometry = buildGeometry(step);
          }
          if (!Number.isFinite(geometry.minGX) || !Number.isFinite(geometry.minGY)) {
            return;
          }
          const originX = padLeft + Math.max(0, Math.floor((availWidth - geometry.drawWidth) / 2)) - geometry.minGX;
          const originY = padTop + Math.max(0, Math.floor((availHeight - geometry.drawHeight) / 2)) - geometry.minGY;
          const point = new obelisk.Point(originX, originY);
          const pixelView = new obelisk.PixelView(canvas, point);

          geometry.cubes.forEach((item) => {
            const dimension = new obelisk.CubeDimension(geometry.cubeSize, geometry.cubeSize, item.cubeHeight);
            const color = new obelisk.CubeColor().getByHorizontalColor(
              Number.isFinite(item.colorValue) ? item.colorValue : fallbackColor
            );
            const cube = new obelisk.Cube(dimension, color, false);
            const p3d = new obelisk.Point3D(item.x3, item.y3, 0);
            pixelView.renderObject(cube, p3d);
          });
        } catch (err) {
          console.error('isometric contribution chart render failed', err);
          container.innerHTML = '<p class="muted-note">3D 热力图渲染失败，请刷新后重试。</p>';
        }
      }

      function ensureSports3DContributionCharts() {
        customResizers.sportsDailyCalories3D = function () {
          renderIsometricContributionChart(
            'chart-sports-daily-calories-3d',
            dailyCaloriesByDate,
            {
              metricLabel: '卡路里贡献',
              unitLabel: 'kcal',
              weekLabel: '最佳一周消耗',
              dayLabel: '最佳一天消耗',
              valuePrecision: 0,
              tiltDegrees: 60,
              palette: ['161b22', '0e4429', '006d32', '26a641', '39d353'],
            }
          );
        };
        customResizers.sportsDailyDuration3D = function () {
          renderIsometricContributionChart(
            'chart-sports-daily-duration-3d',
            dailyDurationByDate,
            {
              metricLabel: '时长贡献',
              unitLabel: 'h',
              weekLabel: '最佳一周时长',
              dayLabel: '最佳一天时长',
              valuePrecision: 2,
              tiltDegrees: 60,
              palette: ['161b22', '0a3f5d', '0b5f8a', '1f87be', '49b9ff'],
            }
          );
        };
        customResizers.sportsDailyCalories3D();
        customResizers.sportsDailyDuration3D();
      }

      function ensureHealthMonthlyChart() {
        if (healthMonthly) return healthMonthly;
        healthMonthly = chartOrNote('chart-health-monthly');
        if (!healthMonthly) return null;
        healthMonthly.setOption({
          ...common,
          legend: { ...common.legend, data: ['月度步数', '月度睡眠时长(h)'] },
          xAxis: { ...common.xAxis, type: 'category', data: labels },
          yAxis: [
            { ...common.yAxis, type: 'value', name: '步数' },
            { ...common.yAxis, type: 'value', name: 'h' },
          ],
          series: [
            {
              name: '月度步数',
              type: 'bar',
              data: monthly.steps_by_month || [],
              itemStyle: { color: '#5c86ff', borderRadius: [6, 6, 0, 0] },
            },
            {
              name: '月度睡眠时长(h)',
              type: 'line',
              yAxisIndex: 1,
              smooth: true,
              data: monthly.sleep_hours_by_month || [],
              lineStyle: { width: 3, color: '#5dffd8' },
              itemStyle: { color: '#5dffd8' },
            },
          ],
        });
        return healthMonthly;
      }

      function ensureHealthDailyTrendCharts() {
        const weightSeries = buildSortedDailySeries(dailyWeightByDate);
        const bodyAgeSeries = buildSortedDailySeries(dailyBodyAgeByDate);
        const restingHrSeries = buildSortedDailySeries(dailyRestingHeartRateByDate);
        const weightRange = computeSeriesRange(weightSeries.values, { pad: 0.25, minSpan: 1.2, precision: 1, minClamp: 0 });
        const restingHrRange = computeSeriesRange(restingHrSeries.values, { pad: 1.0, minSpan: 8.0, precision: 0, minClamp: 0 });

        if (!healthWeightTrend) {
          healthWeightTrend = chartOrNote('chart-health-weight-trend');
        }
        if (healthWeightTrend) {
          healthWeightTrend.setOption({
            ...common,
            grid: isMobile ? { ...common.grid, left: 34, right: 12, bottom: 58 } : { ...common.grid, left: 42, right: 16, bottom: 48 },
            legend: { ...common.legend, data: ['体重'] },
            xAxis: {
              ...common.xAxis,
              type: 'category',
              data: weightSeries.dates,
              axisLabel: {
                color: '#90a8db',
                interval: isMobile ? 29 : 'auto',
                formatter: (value) => String(value || '').slice(5),
              },
            },
            yAxis: {
              ...common.yAxis,
              type: 'value',
              name: 'kg',
              min: weightRange ? weightRange.min : null,
              max: weightRange ? weightRange.max : null,
              scale: true,
            },
            series: [
              {
                name: '体重',
                type: 'line',
                smooth: true,
                symbol: 'circle',
                symbolSize: 4,
                data: weightSeries.values,
                lineStyle: { width: 2.8, color: '#6bc6ff' },
                itemStyle: { color: '#6bc6ff' },
                areaStyle: { color: 'rgba(107, 198, 255, 0.16)' },
                markPoint: {
                  symbolSize: 34,
                  label: { color: '#e9f4ff', fontSize: 10 },
                  data: [{ type: 'max', name: '最高' }, { type: 'min', name: '最低' }],
                },
              },
            ],
          });
        }

        if (!healthBodyAgeTrend) {
          healthBodyAgeTrend = chartOrNote('chart-health-body-age-trend');
        }
        if (healthBodyAgeTrend) {
          healthBodyAgeTrend.setOption({
            ...common,
            grid: isMobile ? { ...common.grid, left: 34, right: 12, bottom: 58 } : { ...common.grid, left: 42, right: 16, bottom: 48 },
            legend: { ...common.legend, data: ['身体年龄'] },
            xAxis: {
              ...common.xAxis,
              type: 'category',
              data: bodyAgeSeries.dates,
              axisLabel: {
                color: '#90a8db',
                interval: isMobile ? 29 : 'auto',
                formatter: (value) => String(value || '').slice(5),
              },
            },
            yAxis: { ...common.yAxis, type: 'value', name: '岁' },
            series: [
              {
                name: '身体年龄',
                type: 'line',
                smooth: true,
                symbol: 'circle',
                symbolSize: 4,
                data: bodyAgeSeries.values,
                lineStyle: { width: 2.8, color: '#8de39d' },
                itemStyle: { color: '#8de39d' },
                areaStyle: { color: 'rgba(141, 227, 157, 0.14)' },
              },
            ],
          });
        }

        if (!healthRestingHeartRateTrend) {
          healthRestingHeartRateTrend = chartOrNote('chart-health-resting-hr-trend');
        }
        if (healthRestingHeartRateTrend) {
          healthRestingHeartRateTrend.setOption({
            ...common,
            grid: isMobile ? { ...common.grid, left: 34, right: 12, bottom: 58 } : { ...common.grid, left: 42, right: 16, bottom: 48 },
            legend: { ...common.legend, data: ['静息心率'] },
            xAxis: {
              ...common.xAxis,
              type: 'category',
              data: restingHrSeries.dates,
              axisLabel: {
                color: '#90a8db',
                interval: isMobile ? 29 : 'auto',
                formatter: (value) => String(value || '').slice(5),
              },
            },
            yAxis: {
              ...common.yAxis,
              type: 'value',
              name: 'bpm',
              min: restingHrRange ? restingHrRange.min : null,
              max: restingHrRange ? restingHrRange.max : null,
              scale: true,
            },
            series: [
              {
                name: '静息心率',
                type: 'line',
                smooth: true,
                symbol: 'circle',
                symbolSize: 4,
                data: restingHrSeries.values,
                lineStyle: { width: 2.8, color: '#ff9ab4' },
                itemStyle: { color: '#ff9ab4' },
                areaStyle: { color: 'rgba(255, 154, 180, 0.15)' },
                markPoint: {
                  symbolSize: 34,
                  label: { color: '#ffe8ef', fontSize: 10 },
                  data: [{ type: 'max', name: '最高' }, { type: 'min', name: '最低' }],
                },
              },
            ],
          });
        }

        if (healthWeightTrend) healthWeightTrend.resize();
        if (healthBodyAgeTrend) healthBodyAgeTrend.resize();
        if (healthRestingHeartRateTrend) healthRestingHeartRateTrend.resize();
      }

      function ensureCompareMonthlyChart() {
        if (compareMonthly) return compareMonthly;
        compareMonthly = chartOrNote('chart-compare-monthly');
        if (!compareMonthly) return null;
        compareMonthly.setOption({
          ...common,
          legend: { ...common.legend, data: [String(report.previous_year || ''), String(report.year || '')] },
          xAxis: { ...common.xAxis, type: 'category', data: labels },
          yAxis: { ...common.yAxis, type: 'value', name: 'km' },
          series: [
            {
              name: String(report.previous_year || ''),
              type: 'line',
              smooth: true,
              data: monthlyPrev.distance_km || [],
              lineStyle: { width: 2.5, color: '#8da4cf' },
              itemStyle: { color: '#8da4cf' },
              areaStyle: { color: 'rgba(141, 164, 207, 0.18)' },
            },
            {
              name: String(report.year || ''),
              type: 'line',
              smooth: true,
              data: monthly.distance_km || [],
              lineStyle: { width: 3.2, color: '#59b7ff' },
              itemStyle: { color: '#59b7ff' },
              areaStyle: { color: 'rgba(89, 183, 255, 0.2)' },
            },
          ],
        });
        return compareMonthly;
      }

      function ensureTabCharts(tab) {
        if (tab === 'overview') {
          const a = ensureOverviewChart();
          const b = ensureSportPieChart();
          ensureOverviewTypeDistributionCharts();
          if (a) a.resize();
          if (b) b.resize();
          return;
        }
        if (tab === 'sports') {
          const a = ensureSportMatrixChart();
          const b = ensureSportCaloriesChart();
          const c = ensureSportsWeeklyIntensityGoalChart();
          ensureSports3DContributionCharts();
          if (a) a.resize();
          if (b) b.resize();
          if (c) c.resize();
          return;
        }
        if (tab === 'health') {
          const a = ensureHealthMonthlyChart();
          ensureHealthDailyTrendCharts();
          if (a) a.resize();
          return;
        }
        if (tab === 'compare') {
          const chart = ensureCompareMonthlyChart();
          if (chart) chart.resize();
        }
      }

      function ensureAllCharts() {
        ensureTabCharts('overview');
        ensureTabCharts('sports');
        ensureTabCharts('health');
        ensureTabCharts('compare');
      }

      function enterPrintMode() {
        if (!reportShell) return;
        reportShell.classList.add('exporting');
        ensureAllCharts();
        setTimeout(resizeAllCharts, 80);
      }

      function leavePrintMode() {
        if (!reportShell) return;
        reportShell.classList.remove('exporting');
        scheduleResizeAllCharts();
      }

      function finishPrintFlow(showTip) {
        leavePrintMode();
        if (exportBtn) {
          exportBtn.disabled = false;
          exportBtn.textContent = exportBtnDefaultText;
        }
        if (printInProgress && showTip) {
          showToast('请在打印面板中选择“另存为 PDF”', 'success');
        }
        printInProgress = false;
      }

      async function exportPdf() {
        if (!exportBtn || !reportShell) return;
        printInProgress = true;
        exportBtn.disabled = true;
        exportBtn.textContent = '打开打印面板...';
        enterPrintMode();
        await new Promise((resolve) => requestAnimationFrame(() => requestAnimationFrame(resolve)));
        await new Promise((resolve) => setTimeout(resolve, 220));
        try {
          window.print();
        } catch (err) {
          console.error('打开打印面板失败', err);
          showToast('无法打开打印面板', 'error');
          finishPrintFlow(false);
          return;
        }
        // Fallback for browsers that do not fire afterprint reliably.
        setTimeout(() => {
          if (printInProgress) {
            finishPrintFlow(true);
          }
        }, 8000);
      }

      if (exportBtn) {
        exportBtn.addEventListener('click', function (event) {
          if (event.shiftKey) {
            shareReportLink();
            return;
          }
          exportPdf();
        });
        exportBtn.addEventListener('contextmenu', function (event) {
          event.preventDefault();
          shareReportLink();
        });
      }

      window.addEventListener('beforeprint', function () {
        enterPrintMode();
      });
      window.addEventListener('afterprint', function () {
        finishPrintFlow(true);
      });

      function resizeAllCharts() {
        chartRefs.forEach((chart) => chart.resize());
        Object.values(customResizers).forEach((fn) => {
          if (typeof fn === 'function') {
            fn();
          }
        });
      }

      function scheduleResizeAllCharts() {
        if (resizeRaf) {
          cancelAnimationFrame(resizeRaf);
        }
        resizeRaf = requestAnimationFrame(() => {
          resizeAllCharts();
        });
      }

      function resolveActiveTab() {
        const params = new URLSearchParams(window.location.search);
        const fromQuery = params.get('tab');
        if (fromQuery && ['overview', 'sports', 'health', 'compare'].includes(fromQuery)) {
          return fromQuery;
        }
        const activeBtn = document.querySelector('.tab-button.active');
        const activeLabel = activeBtn ? (activeBtn.textContent || '').trim() : '';
        if (activeLabel === '概览总览') return 'overview';
        if (activeLabel === '运动分析') return 'sports';
        if (activeLabel === '健康洞察') return 'health';
        if (activeLabel === '年度对比') return 'compare';
        return 'overview';
      }

      window.addEventListener('resize', scheduleResizeAllCharts);
      window.addEventListener('orientationchange', scheduleResizeAllCharts);
      window.addEventListener('garmin-tab-change', function () {
        ensureTabCharts(resolveActiveTab());
        setTimeout(scheduleResizeAllCharts, 80);
      });
      ensureTabCharts(resolveActiveTab());
      setTimeout(scheduleResizeAllCharts, 50);
      const params = new URLSearchParams(window.location.search);
      if (params.get('printPreview') === '1') {
        enterPrintMode();
        setTimeout(scheduleResizeAllCharts, 120);
      }
    })();

  </script>
</body>
</html>
